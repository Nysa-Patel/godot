(function(g){var window=this;'use strict';var yVN=function(q){var J=new g.vM("und",new g.mg("Default","und",!0));J.captionTracks=q.captionTracks;return J},p_Q=function(q){return new g.yH(function(J,t){var x=q.length,k=[];
if(x)for(var H=function(Y,N){x--;k[Y]=N;x==0&&J(k)},v=function(Y){t(Y)},r,C=0;C<q.length;C++)r=q[C],g.z84(r,g.Ht(H,C),v);
else J(k)})},XV=function(q){this.B=q},Pp=function(){XV.apply(this,arguments)},sEt=function(){Pp.apply(this,arguments)},SXo=function(){Pp.apply(this,arguments)},DQD=function(){Pp.apply(this,arguments)},nPP=function(){Pp.apply(this,arguments)},Z8u=function(){Pp.apply(this,arguments)},QEo=function(){Pp.apply(this,arguments)},BgQ=function(){XV.apply(this,arguments)},AVQ=function(){Pp.apply(this,arguments)},$Qx=function(){Pp.apply(this,arguments)},IJP=function(){Pp.apply(this,arguments)},hVV=function(){Pp.apply(this,
arguments)},X_0=function(){Pp.apply(this,arguments)},PRQ=function(){Pp.apply(this,arguments)},UQZ=function(){Pp.apply(this,arguments)},TgN=function(){Pp.apply(this,arguments)},jEN=function(){Pp.apply(this,arguments)},KPo=function(){Pp.apply(this,arguments)},WPV=function(){Pp.apply(this,arguments)},dQt=function(){Pp.apply(this,arguments)},fJP=function(){XV.apply(this,arguments)},eVP=function(){Pp.apply(this,arguments)},LPt=function(){Pp.apply(this,arguments)},lJ5=function(){Pp.apply(this,arguments)},
uHD=function(){Pp.apply(this,arguments)},w_D=function(){Pp.apply(this,arguments)},VF0=function(){Pp.apply(this,arguments)},zVZ=function(){Pp.apply(this,arguments)},GxN=function(){Pp.apply(this,arguments)},aJo=function(){Pp.apply(this,arguments)},qT0=function(){XV.apply(this,arguments)},Jvt=function(){XV.apply(this,arguments)},tcN=function(){XV.apply(this,arguments)},xhQ=function(){Pp.apply(this,arguments)},k8Z=function(){Pp.apply(this,arguments)},i3t=function(){Pp.apply(this,arguments)},H3V=function(){Pp.apply(this,
arguments)},vwD=function(){Pp.apply(this,arguments)},R1t=function(){Pp.apply(this,arguments)},rvB=function(){Pp.apply(this,arguments)},CJN=function(){Pp.apply(this,arguments)},YTP=function(){Pp.apply(this,arguments)},N4B=function(){Pp.apply(this,arguments)},b3D=function(){Pp.apply(this,arguments)},mho=function(){Pp.apply(this,arguments)},O3D=function(){Pp.apply(this,arguments)},FQQ=function(){Pp.apply(this,arguments)},EwQ=function(){Pp.apply(this,arguments)},cvB=function(){Pp.apply(this,arguments)},
McV=function(){Pp.apply(this,arguments)},owa=function(){Pp.apply(this,arguments)},gwP=function(){Pp.apply(this,arguments)},yv0=function(){Pp.apply(this,arguments)},pit=function(){Pp.apply(this,arguments)},sr5=function(){Pp.apply(this,arguments)},STQ=function(){Pp.apply(this,arguments)},Dhx=function(){Pp.apply(this,arguments)},nwQ=function(){Pp.apply(this,arguments)},Z3N=function(){Pp.apply(this,arguments)},QrB=function(){XV.apply(this,arguments)},B4P=function(){Pp.apply(this,arguments)},Ava=function(){Pp.apply(this,
arguments)},$hB=function(){Pp.apply(this,arguments)},IHN=function(){Pp.apply(this,arguments)},h1x=function(){Pp.apply(this,arguments)},XiN=function(){Pp.apply(this,arguments)},PJD=function(){Pp.apply(this,arguments)},Uha=function(){Pp.apply(this,arguments)},T45=function(){Pp.apply(this,arguments)},jr5=function(){Pp.apply(this,arguments)},KQ5=function(){Pp.apply(this,arguments)},WQu=function(){Pp.apply(this,arguments)},dht=function(){Pp.apply(this,arguments)},fHQ=function(){Pp.apply(this,arguments)},
e1V=function(){Pp.apply(this,arguments)},LQ5=function(){Pp.apply(this,arguments)},lHB=function(){Pp.apply(this,arguments)},uqN=function(){Pp.apply(this,arguments)},wi5=function(){Pp.apply(this,arguments)},Vcu=function(){Pp.apply(this,arguments)},z1N=function(){Pp.apply(this,arguments)},G8B=function(){Pp.apply(this,arguments)},aHP=function(){Pp.apply(this,arguments)},q9u=function(){Pp.apply(this,arguments)},J9Q=function(){Pp.apply(this,arguments)},tIN=function(){Pp.apply(this,arguments)},xgt=function(){Pp.apply(this,
arguments)},kaN=function(){Pp.apply(this,arguments)},iZx=function(){Pp.apply(this,arguments)},HZB=function(){Pp.apply(this,arguments)},v2V=function(){Pp.apply(this,arguments)},RLN=function(){Pp.apply(this,arguments)},r90=function(q){q=q.key||q.id;
if(!q)throw Error("Entity key is missing");return q},CFt=function(){if(Uj)return Uj();
var q={};Uj=g.Gg("PersistentEntityStoreDb",{Zp:(q.EntityStore={jp:1},q.EntityAssociationStore={jp:2},q),shared:!1,upgrade:function(J,t){t(1)&&g.IK(g.nR(J,"EntityStore",{keyPath:"key"}),"entityType","entityType");t(2)&&(J=g.nR(J,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.IK(J,"byParentEntityKey","parentEntityKey"),g.IK(J,"byChildEntityKey","childEntityKey"))},
version:3});return Uj()},Y90=function(q){return g.WB(CFt(),q)},Npa=function(q){return g.WB((0,g.VdN)(),q)},TL=function(q){this.token=q},jC=function(q,J){J=J===void 0?{}:J;
g.LP.call(this,g.zM5[q],Object.assign({},{name:"PESEncoderError",type:q},J));this.type=q;this.level="WARNING";Object.setPrototypeOf(this,jC.prototype)},bZo=function(q){return new jC("WRONG_DATA_TYPE",{b_:q})},mgB=function(q){return q instanceof Error?new jC("UNKNOWN_ENCODE_ERROR",{originalMessage:q.message}):new jC("UNKNOWN_ENCODE_ERROR")},OZa=function(q){return q instanceof Error?new jC("UNKNOWN_DECODE_ERROR",{originalMessage:q.message}):new jC("UNKNOWN_DECODE_ERROR")},FyB=function(q,J){q=q instanceof
jC?q:J(q);
g.$$(q);throw q;},E2P=function(){},c9D=function(q,J,t){try{return q.C(J,t)}catch(x){FyB(x,mgB)}},MIx=function(q){q=(new TextEncoder).encode(q).subarray(0,16);
var J=new Uint8Array(16);J.set(q);return J},Ky=function(q){this.B=q},g2a=function(q){var J=o2a[q];
if(J)return J;g.IF(new g.LP("Entity model not found.",{entityType:q}))},y9N=function(q,J){this.B=q;
this.D=J;this.C={}},s65=function(q,J){a:{q=pRN(q.D,J.version);
try{var t=q.D(J.data,J.key);break a}catch(x){FyB(x,OZa)}t=void 0}return t},Wp=function(q,J,t){return q.B.objectStore("EntityStore").get(J).then(function(x){if(x){if(t&&x.entityType!==t)throw Error("Incorrect entity type");
return s65(q,x)}})},du=function(q,J,t){return t?(t=t.map(function(x){return Wp(q,x,J)}),g.y6.all(t)):q.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(J)).then(function(x){return x.map(function(k){return s65(q,k)})})},eC=function(q,J,t){var x=r90(J),k=pRN(q.D,1),H=Object.assign({},J);
return q.B.objectStore("EntityStore").get(x).then(function(v){if(v){if(v.entityType!==t)throw Error("Incorrect entity type");H.entityMetadata||(v=s65(q,v),H.entityMetadata=v.entityMetadata)}}).then(function(){var v={key:x,
entityType:t,data:c9D(k,H,x),version:1};return g.y6.all([g.BB(q.B.objectStore("EntityStore"),v),S9Q(q,H,t)])}).then(function(){fy(q,x,t);
return x})},DgV=function(q,J,t){J=J.map(function(x){return eC(q,x,t)});
return g.y6.all(J)},Ly=function(q,J,t){if(t==null?0:t.XY){var x=new Set;
return n2o(q,J,x).then(function(){for(var H=[],v=g.M(x),r=v.next();!r.done;r=v.next())H.push(Ly(q,r.value));return g.y6.all(H).then(function(){})})}var k=g.l$(J).entityType;
return g.y6.all([q.B.objectStore("EntityStore").delete(J),ZZQ(q,J)]).then(function(){fy(q,J,k)})},Q60=function(q,J){return g.UQ(q.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(J)},function(t){return g.y6.all([t.delete(),
ZZQ(q,t.cursor.primaryKey)]).then(function(){fy(q,t.cursor.primaryKey,J);return g.Xu(t)})})},BpN=function(q,J,t,x){var k=pRN(q.D,1);
return Wp(q,J,x).then(function(H){if(H){H=g.b$(H,t);var v={key:J,entityType:x,data:c9D(k,H,J),version:1};return g.y6.all([g.BB(q.B.objectStore("EntityStore"),v),S9Q(q,H,x)])}}).then(function(){fy(q,J,x);
return J})},fy=function(q,J,t){var x=q.C[t];
x||(x=new Set,q.C[t]=x);x.add(J)},A90=function(q,J,t){var x=r90(J);
t=g2a(t);if(!t)return g.y6.resolve([]);t=new t(J);q=q.B.objectStore("EntityAssociationStore");J=[];t=g.M(t.D());for(var k=t.next();!k.done;k=t.next())J.push(g.BB(q,{parentEntityKey:x,childEntityKey:k.value}));return g.y6.all(J).then(function(H){return H.map(function(v){return v[1]})})},ZZQ=function(q,J){return q.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(J))},S9Q=function(q,J,t){var x=r90(J);
return ZZQ(q,x).then(function(){return A90(q,J,t)})},n2o=function(q,J,t){if(t.has(J))return g.y6.resolve(void 0);
t.add(J);return $gV(q,J).then(function(x){return q.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(J)).then(function(){return x})}).then(function(x){var k=g.y6.resolve(void 0);
x=g.M(x);for(var H=x.next(),v={};!H.done;v={Uj:void 0},H=x.next())v.Uj=H.value,k=k.then(function(r){return function(){return n2o(q,r.Uj,t)}}(v));
return k}).then(function(){})},$gV=function(q,J){var t=q.B.objectStore("EntityAssociationStore");
return t.index("byParentEntityKey").getAll(IDBKeyRange.only(J)).then(function(x){var k=[];x=g.M(x);for(var H=x.next();!H.done;H=x.next())H=H.value,k.push(t.index("byChildEntityKey").getAll(H.childEntityKey));return g.y6.all(k)}).then(function(x){var k=[];
x=g.M(x);for(var H=x.next();!H.done;H=x.next())H=H.value,H.length===1&&k.push(H[0].childEntityKey);return k})},lE=function(){},ITN=function(){this.B={};
this.B[0]=new lE;if(!g.M3("aes_pes_encoder_killswitch")){var q=this.B;try{var J=g.lY();var t=MIx(J);var x=new Ky(new g.My(t),new g.cV(t))}catch(k){throw q=k instanceof Error?new jC("KEY_CREATION_FAILED",{originalMessage:k.message}):new jC("KEY_CREATION_FAILED"),g.$$(q),q;}q[1]=x}},pRN=function(q,J){J=J===void 0?0:J;
q=q.B[J];if(!q)throw J=new jC("INVALID_ENCODER_VERSION",{b_:J}),g.$$(J),J;return q},uE=function(q,J){g.K.call(this);
this.token=q;this.B=J;this.observers=[];q=new g.uB.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.lY());q.onmessage=this.D.bind(this);this.channel=q},wu=function(q,J,t){var x,k,H,v;
return g.U(function(r){if(r.D==1)return g.I(r,Y90(q.token),2);if(r.D!=3)return x=r.B,g.I(r,g.Q6(x,["EntityStore","EntityAssociationStore"],J,function(C){k=new y9N(C,q.B);return t(k)}),3);
H=r.B;k&&(v=k.C,Object.keys(v).length>0&&(q.channel.postMessage(v),hLt(q,v)));return r.return(H)})},Vu=function(q,J,t){return wu(q,{mode:"readwrite",
HK:!0},function(x){return eC(x,J,t)})},XR0=function(q,J){return wu(q,{mode:"readwrite",
HK:!0},function(t){return DgV(t,J,"offlineOrchestrationActionWrapperEntity")})},PFB=function(q,J){return wu(q,{mode:"readwrite",
HK:!0},function(t){return Ly(t,J)})},Ug5=function(q){return wu(q,{mode:"readwrite",
HK:!0},function(J){return Q60(J,"videoPlaybackPositionEntity")})},zL=function(q,J,t){return wu(q,{mode:"readonly",
HK:!0},function(x){return Wp(x,J,t)})},GL=function(q,J,t){return wu(q,{mode:"readonly",
HK:!0},function(x){return du(x,J,t)})},hLt=function(q,J){q=g.M(q.observers);
for(var t=q.next();!t.done;t=q.next())t=t.value,t(J)},TpQ=function(){var q,J,t;
return g.U(function(x){if(x.D==1)return g.gq(x,2),g.I(x,g.V6(),4);if(x.D!=2){q=x.B;if(!q||!g.uY()||typeof g.uB.BroadcastChannel==="undefined")return x.return();J=new ITN;return x.return(new uE(q,J))}t=g.Zi(x);t instanceof Error&&g.$$(t);return x.return()})},at=function(){j6x||(j6x=TpQ());
return j6x},KyQ=function(q){var J;
q=(J=q.options)==null?void 0:J.persistenceOption;return q==="ENTITY_PERSISTENCE_OPTION_PERSIST"||q==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Wya=function(q){var J;
return g.U(function(t){return t.D==1?g.I(t,at(),2):(J=t.B)?g.I(t,wu(J,"readwrite",function(x){for(var k={},H=g.M(q),v=H.next(),r={};!v.done;r={fl:void 0,UB:void 0},v=H.next())r.fl=v.value,r.fl.entityKey&&KyQ(r.fl)&&(r.UB=g.eP(r.fl.payload),v=void 0,r.fl.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(v=function(C){return function(){return eC(x,C.fl.payload[C.UB],C.UB)}}(r)),r.fl.type==="ENTITY_MUTATION_TYPE_DELETE"&&(v=function(C){return function(){return Ly(x,C.fl.entityKey)}}(r)),r.fl.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(v=function(C){return function(){return BpN(x,C.fl.entityKey,C.fl.payload[C.UB],C.UB)}}(r)),v&&(k[r.fl.entityKey]=k[r.fl.entityKey]?k[r.fl.entityKey].then(v):v()));
return g.y6.all(Object.values(k))}),0):t.return()})},dgo=function(q){var J;
return g.U(function(t){if(t.D==1){J=q.mutations;if(!J||J.length<=0)return t.return();if(g.t1){var x={type:"ENTITY_LOADED"};J!==void 0&&(x.payload=J);g.t1.dispatch(x)}return g.I(t,Wya(J),2)}J.length=0;g.oC(t)})},fTN=function(q){return q!==void 0},eLB=function(q){var J=g.Ql();
J=Object.assign({},J);q=Object.assign({},q);for(var t in J)q[t]?(J[t]!==4&&(J[t]=q[t]),delete q[t]):J[t]!==2&&(J[t]=4);Object.assign(J,q);g.O5X(J);JSON.stringify(J);return J},LyN=function(q){var J,t;
return g.U(function(x){if(x.D==1)return g.I(x,g.V6(),2);if(x.D!=3)return(J=x.B)?g.I(x,g.$h(J),3):x.return();t=x.B;return x.return(g.Q6(t,["index","media","captions"],{mode:"readwrite",HK:!0},function(k){var H=IDBKeyRange.bound(q+"|",q+"~");k=[k.objectStore("index").delete(H),k.objectStore("media").delete(H),k.objectStore("captions").delete(H)];return g.y6.all(k).then(function(){})}))})},lTa=function(){var q,J;
return g.U(function(t){if(t.D==1)return g.I(t,g.V6(),2);if(t.D!=3){q=t.B;if(!q)throw g.oK("rvdfd");return g.I(t,g.$h(q),3)}J=t.B;return t.return(g.Q6(J,["index","media"],{mode:"readwrite",HK:!0},function(x){var k={};return g.hA(x.objectStore("index"),{},function(H){var v=H.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),r=g.y6.resolve(void 0);if(v){var C=v[1];v=v[2];k[C]=k[C]||{};var Y;k[C][v]=g.onq((Y=H.getValue())==null?void 0:Y.fmts)}else r=H.delete().then(function(){});
return g.y6.all([g.Xu(H),r]).then(function(N){return g.M(N).next().value})}).then(function(){for(var H={},v=g.M(Object.keys(k)),r=v.next();!r.done;r=v.next()){r=r.value;
var C=k[r].v;H[r]=k[r].a&&C?1:2}var Y=eLB(H);return g.ALC(x.objectStore("media"),{},function(N){var b=N.cursor.key.match(g.snC);b&&H[b[1]]||x.objectStore("media").delete(N.cursor.key);return g.yLi(N)}).then(function(){return Y})})}))})},uAN=function(q,J){var t,x;
return g.U(function(k){if(k.D==1)return g.I(k,g.V6(),2);if(k.D!=3){t=k.B;if(!t)throw g.oK("wct");return g.I(k,g.$h(t),3)}x=k.B;return g.I(k,g.Q6(x,["captions"],{mode:"readwrite",HK:!0},function(H){var v=[];H=H.objectStore("captions");for(var r=0;r<J.length;r++){var C=g.BB(H,J[r],q+"|"+J[r].metadata.vss_id);v.push(C)}return g.y6.all(v)}),0)})},wRD=function(q){var J,t,x;
return g.U(function(k){if(k.D==1)return J=IDBKeyRange.bound(q+"|",q+"~"),g.I(k,g.V6(),2);if(k.D!=3){t=k.B;if(!t)throw g.oK("gactfv");return g.I(k,g.$h(t),3)}x=k.B;return k.return(x.getAll("captions",J))})},VIa=function(q){return g.U(function(J){g.AQ(q,0);
return J.return(LyN(q))})},zLt=function(q){return{context:g.w5(),
videoIds:q}},GaP=function(q){return{context:g.w5(),
playlistIds:q}},aT5=function(q){return{context:g.w5(),
offlinePlaylistSyncChecks:q}},qeZ=function(){this.B=new Map},txa=function(){JJu||(JJu=new qeZ);
return JJu},xzQ=function(q,J){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:q},metadata:J,statusCode:void 0,csn:void 0,can:void 0}},kbN=function(q,J,t){if(!t){var x=x===void 0?!1:x;
t=q.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!t||x)t=g.gS(16),q.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",t)}q={flowNonce:t,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:J.eventType};J.metadata&&(q.flowMetadata=J.metadata);J.statusCode!==void 0&&(q.flowEventStatus=J.statusCode);J.csn&&(q.csn=J.csn);J.can&&(q.can=J.can);g.RK("flowEvent",q,void 0)},ino=function(q){var J,t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL;
return g.U(function(Qa){if(Qa.D==1)return g.I(Qa,wu(q,{mode:"readonly",HK:!0},function(FB){return du(FB,"playbackData").then(function(KX){var XB=KX.map(function(A){return A.transfer}).filter(function(A){return!!A}),Bt=KX.map(function(A){return A.offlineVideoPolicy}).filter(function(A){return!!A}),Q=KX.filter(function(A){return!!A.key}).map(function(A){return g.u$(g.l$(A.key).entityId,"downloadStatusEntity")});
XB=du(FB,"transfer",XB);Bt=du(FB,"offlineVideoPolicy",Bt);Q=du(FB,"downloadStatusEntity",Q);var B=XB.then(function(A){A=A.reduce(function(P,e){(e==null?0:e.offlineVideoStreams)&&P.push.apply(P,g.Z(e.offlineVideoStreams));return P},[]).filter(function(P){return!!P});
return du(FB,"offlineVideoStreams",A)});
return g.y6.all([XB,Bt,B,Q]).then(function(A){var P=g.M(A);A=P.next().value;var e=P.next().value;var sV=P.next().value;P=P.next().value;return[KX,A,e,sV,P]})})}),2);
if(Qa.D!=3)return J=Qa.B,g.I(Qa,wu(q,{mode:"readonly",HK:!0},function(FB){return du(FB,"mainDownloadsListEntity").then(function(KX){var XB,Bt;return(Bt=(XB=KX[0])==null?void 0:XB.downloads)!=null?Bt:[]})}),3);
t=Qa.B;x=g.M(J);k=x.next().value;H=x.next().value;v=x.next().value;r=x.next().value;C=x.next().value;Y=k;N=H;b=v;m=r;O=C;F={};y={};p={};n={};D={};h=[];X=g.M(N);for(d=X.next();!d.done;d=X.next())(z=d.value)&&(F[z.key]=z);u=g.M(b);for(x4=u.next();!x4.done;x4=u.next())(iB=x4.value)&&(y[iB.key]=iB);qP=g.M(O);for(rq=qP.next();!rq.done;rq=qP.next())(G=rq.value)&&(p[G.key]=G);yn=g.M(m);for(nX=yn.next();!nX.done;nX=yn.next())(fX=nX.value)&&(n[fX.key]=fX);SP=g.M(t);for(rQ=SP.next();!rQ.done;rQ=SP.next())Qn=
rQ.value,Di=void 0,D[(Di=Qn.videoItem)!=null?Di:""]=!0,Qn.videoItem&&(S=ix=void 0,RC=(S=(ix=g.l$(Qn.videoItem))==null?void 0:ix.entityId)!=null?S:"",h.push({externalVideoId:RC}));lx=Y.filter(function(FB){if(!FB||!FB.key||!FB.offlineVideoPolicy)return!1;FB=g.l$(FB.key).entityId;FB=g.u$(FB,"downloadStatusEntity");var KX;return!(FB&&((KX=p[FB])==null?void 0:KX.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
yL=lx.map(function(FB){var KX=F[FB.transfer],XB=[];if(KX==null?0:KX.offlineVideoStreams)for(var Bt=g.M(KX.offlineVideoStreams),Q=Bt.next();!Q.done;Q=Bt.next())(Q=n[Q.value])&&XB.push(Q);Bt=y[FB.offlineVideoPolicy];Q=D;var B=FB==null?void 0:FB.playerResponseTimestamp,A=g.l$(Bt.key).entityId;FB=g.u$(A,"mainVideoEntity");if(Bt.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var P="OFFLINE_VIDEO_STATE_DISABLED";Bt.expirationTimestamp&&Number(Bt.expirationTimestamp)<Date.now()/1E3&&(P="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Bt.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")P="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(KX==null?void 0:KX.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":P="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":P="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":P="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":P="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":P="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":P="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:P="OFFLINE_VIDEO_STATE_UNKNOWN"}if(P==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(KX==null?void 0:KX.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":P="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":P="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":P=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}A={id:A,videoState:P};if(KX==null?0:KX.cotn)A.cotn=KX.cotn;if(KX==null?0:KX.maximumDownloadQuality)A.selectedVideoQuality=KX==null?void 0:KX.maximumDownloadQuality;if(KX==null?0:KX.lastProgressTimeMs)A.lastProgressTimeMs=KX.lastProgressTimeMs;B&&(A.playerResponseSavedTimeMs=String(Number(B)*1E3));KX=String;B=0;XB=g.M(XB);for(P=XB.next();!P.done;P=XB.next())if(P=P.value,P.streamsProgress){P=g.M(P.streamsProgress);for(var e=P.next();!e.done;e=P.next()){var sV=void 0;
B+=Number((sV=e.value.numBytesDownloaded)!=null?sV:0)}}A.downloadedBytes=KX(B);A.selectedOfflineMode=Q[FB]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Bt.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(A.offlinePlaybackDisabledReason=Bt.offlinePlaybackDisabledReason);return A});
return Qa.return({offlineVideos:yL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:h}}})})},HnQ=function(){this.locks=navigator.locks},vKQ=function(){try{var q=g.Vn("ytglobal.locks_");
if(q)return q;var J;if(J=navigator){var t=navigator;J="locks"in t&&!!t.locks}if(J)return g.uB.localStorage&&g.uB.localStorage.getItem("noop"),q=new HnQ,g.wq("ytglobal.locks_",q),q}catch(x){}},qt=function(){},RgP=function(){},rJQ=function(q){if(q.includes(":"))throw Error("Invalid user cache name: "+q);
return q+":"+g.lY("CacheStorage get")},CnZ=function(){return g.U(function(q){if(Jz!==void 0)return q.return(Jz);
Jz=new Promise(function(J){var t;return g.U(function(x){switch(x.D){case 1:return g.gq(x,2),g.I(x,tz.open("test-only"),4);case 4:return g.I(x,tz.delete("test-only"),5);case 5:g.St(x,3);break;case 2:if(t=g.Zi(x),t instanceof Error&&t.name==="SecurityError")return J(!1),x.return();case 3:J("caches"in window),g.oC(x)}})});
return q.return(Jz)})},N_B=function(){return g.U(function(q){if(q.D==1)return g.I(q,CnZ(),2);
if(!q.B)return q.return(void 0);YeN||(YeN=new RgP);return q.return(YeN)})},xa=function(q,J,t){g.IF(new g.LP("Woffle: "+q,t?{cotn:t}:""));
J instanceof Error&&g.IF(J)},bn5=function(q){var J;
return g.U(function(t){if(t.D==1)return g.I(t,ino(q),2);J=t.B;g.RK("offlineStateSnapshot",J);g.oC(t)})},ka=function(q){g.K.call(this);
var J=this;this.api=q;this.BW={gT8:function(){return J.B},
b_8:function(){return J.D}};
typeof g.uB.BroadcastChannel!=="undefined"&&(this.B=new g.uB.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.lY()),this.B.onmessage=this.C.bind(this),this.D=new g.uB.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.lY()),this.D.onmessage=this.Y.bind(this))},ig=function(q,J){q.api.Sr("onOfflineOperationFailure",J);
var t;(t=q.B)==null||t.postMessage(J)},mzQ=function(q,J,t,x){var k=this;
this.W=q;this.X=J;this.visibility=t;this.G=x;this.V=this.L=this.N=this.C=this.B=!1;this.Y=new g.wG(function(){k.BH()});
this.BW={gD:function(){return k.D},
BH:function(){k.BH()},
zDj:function(){return k.Y}};
this.visibility.subscribe("visibilitystatechange",function(){k.Un()})},OnN=function(q){if(!q.C&&!q.B){var J=vKQ();
if(J){q.C=!0;var t=g.lY("OfflineLockManager");J.request("woffle_orchestration_leader:"+t,{},function(){var x,k,H,v;return g.U(function(r){switch(r.D){case 1:return g.gq(r,2),q.D=new g.YK,q.B=!0,q.C=!1,g.I(r,q.W(),4);case 4:return g.I(r,q.D.promise,5);case 5:g.St(r,0);break;case 2:x=g.Zi(r),((H=(k=q).G)==null?0:H.call(k,"wo_relinquish_leadership_on_lock_request_error"))||q.BH(),x instanceof Error&&(v=x,v.args=[{name:"WoLockManagerError",q7:x.name}],g.$$(v)),g.oC(r)}})})}}},F3Q=function(q){q.B&&(q.V=
!0,Hh(q))},EKV=function(q,J){q.B&&(q.N=J,Hh(q))},cJt=function(q,J){q.B&&(q.L=J,Hh(q))},Hh=function(q){q.L&&q.N&&q.V&&q.visibility.isBackground()?g.V$(q.Y,6E4):q.Y.stop()},vh=function(q){var J;
q.offlineDeleteReason=(J=q.offlineDeleteReason)!=null?J:"OFFLINE_DELETE_REASON_UNKNOWN";var t;q.offlineModeType=(t=q.offlineModeType)!=null?t:"OFFLINE_NOW";g.RK("offlineDeleteEvent",q)},RZ=function(q,J){var t=J.videoId;
var x=J.JD;J=J.offlineModeType;q.encryptedVideoId=t;q.cotn=x==null?void 0:x.cotn;q.offlineabilityFormatType=x==null?void 0:x.maximumDownloadQuality;var k;q.isRefresh=(k=x==null?void 0:x.isRefresh)!=null?k:!1;var H;q.softErrorCount=(H=x==null?void 0:x.transferRetryCount)!=null?H:0;q.offlineModeType=J!=null?J:"OFFLINE_NOW";(q.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&q.statusType==="UNKNOWN_STATUS_TYPE"||!q.transferStatusType&&!q.statusType)&&g.IF(Error("Woffle unknown transfer status"));
g.RK("offlineTransferStatusChanged",q)},Mx0=function(q){RZ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},q)},oKZ=function(q,J,t,x){x={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!x};J&&t&&(J=Math.floor(J/1024).toFixed(),t=Math.floor(t/1024).toFixed(),x.alreadyDownloadedKbytes=J,x.totalFetchedKbytes=J,x.totalContentKbytes=t);RZ(x,q)},gKN=function(q){RZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},q)},yJ0=function(q){RZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},q)},pI5=function(q){switch(q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
rT=function(q){var J,t,x;
return((x=(J=q.actionMetadata)==null?void 0:(t=J.retryScheduleIntervalsInSeconds)==null?void 0:t.length)!=null?x:0)>0},C0=function(q){return q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!q.entityKey},Ya=function(q){return q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!q.entityKey},Nt=function(q){return q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!q.entityKey},sSo=function(q){return q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!q.entityKey},
bg=function(q,J,t,x,k){k=k===void 0?!1:k;
var H,v,r,C,Y,N;return g.U(function(b){if(b.D==1)return H=g.u$(q,J),v=g.u$(q,"downloadStatusEntity"),g.I(b,wu(t,{mode:"readonly",HK:!0},function(m){return g.y6.all([Wp(m,H,J),Wp(m,v,"downloadStatusEntity")])}),2);
r=b.B;C=r.length?r[0]:void 0;if(!C)return b.bX(0);Y=Seu;if(N=r.length>1?r[1]:void 0){if(N.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!k)return b.return();N.downloadState=x}else N={key:v,downloadState:x};g.Tk(C,Y,N);return g.I(b,wu(t,{mode:"readwrite",HK:!0},function(m){return g.y6.all([eC(m,C,J),eC(m,N,"downloadStatusEntity")])}),0)})},mu=function(q,J){return q.actionType===J.actionType&&q.entityKey===J.entityKey},O4=function(q,J){if(q&&q.transferState!=="TRANSFER_STATE_COMPLETE"&&q.transferState!==
"TRANSFER_STATE_FAILED"){var t=g.l$(q.key).entityId;
RZ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:t,JD:q,offlineModeType:J})}},Fx=function(q){if(!q||!q.thumbnails)return[];
var J=[];q=g.M(q.thumbnails);for(var t=q.next();!t.done;t=q.next())t=t.value,t.url&&J.push(t.url);return J},Dzu=function(q,J,t){t=t===void 0?[]:t;
var x,k,H,v,r,C,Y,N,b,m,O,F,y;return g.U(function(p){if(p.D==1)return t.length?g.I(p,GL(q,J),2):p.return([]);x=p.B;k=new Set;H=g.M(x);for(v=H.next();!v.done;v=H.next())if(r=v.value,C=r.id||r.key)Y=g.l$(C).entityId,k.add(Y);N=[];b=g.M(t);for(m=b.next();!m.done;m=b.next())O=m.value,F=O.offlineVideoData,y=void 0,((y=F)==null?0:y.videoId)&&!k.has(F.videoId)&&N.push(O);return p.return(N)})},nKZ=function(q,J,t){return new g.eD(q,{cotn:J,
raw_player_response:t,download_media:!0,start:Infinity,disable_watch_next:!0})},ZnZ=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},E4=function(q,J,t,x,k,H,v,r,C,Y,N){this.entityType=q;
this.actionId=J;this.action=t;this.parentActionId=x;this.rootActionId=k===void 0?J:k;this.childActionIds=H;this.prereqActionId=v;this.postreqActionIds=r;this.hasChildActionFailed=Y;this.retryScheduleIndex=0;this.B=N||Date.now();this.retryScheduleIndex=C||0},ch=function(q){if(!q.key)throw Error("Entity key is required.");
if(!q.actionProto)throw Error("OfflineOrchestrationAction is required.");var J=g.l$(q.key),t=g.l$(q.actionProto.entityKey);return new E4(t.entityType,J.entityId,q.actionProto,q.parentActionId,q.rootActionId,q.childActionIds,q.prereqActionId,q.postreqActionIds,q.retryScheduleIndex,q.hasChildActionFailed,Number(q.enqueueTimeSec)*1E3)},Mt=function(q){return{key:g.u$(q.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:q.action,parentActionId:q.parentActionId,rootActionId:q.rootActionId,childActionIds:q.childActionIds,prereqActionId:q.prereqActionId,postreqActionIds:q.postreqActionIds,retryScheduleIndex:q.retryScheduleIndex,hasChildActionFailed:q.hasChildActionFailed,enqueueTimeSec:(q.B/1E3).toFixed()}},QSx=function(){var q;
return g.U(function(J){return J.D==1?g.I(J,N_B(),2):(q=J.B)?J.return(q.delete("yt-player-local-img")):J.return(!0)})},oZ=function(q){var J,t;
return g.U(function(x){if(x.D==1)return g.I(x,N_B(),2);if(x.D!=3){J=x.B;if(!J)throw Error("Cache API not supported");return q.length?g.I(x,J.open("yt-player-local-img"),3):x.return()}t=x.B;return g.I(x,Promise.all(q.map(function(k){return t.delete(k)})),0)})},gT=function(q){var J,t;
return g.U(function(x){if(x.D==1)return g.I(x,N_B(),2);if(x.D!=3){J=x.B;if(!J)throw Error("Cache API not supported");return q.length?g.I(x,J.open("yt-player-local-img"),3):x.return()}t=x.B;return g.I(x,t.addAll(q),0)})},y3=function(q,J,t,x,k){var H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di;
return g.U(function(ix){switch(ix.D){case 1:return H=g.u$(q,"mainVideoEntity"),v=g.u$(q,"ytMainChannelEntity"),r=g.u$(q,"transfer"),C=g.u$(q,"videoDownloadContextEntity"),g.I(ix,wu(J,{mode:"readonly",HK:!0},function(S){return g.y6.all([Wp(S,H,"mainVideoEntity"),Wp(S,v,"ytMainChannelEntity"),Wp(S,r,"transfer"),Wp(S,C,"videoDownloadContextEntity"),du(S,"ytMainChannelEntity"),du(S,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Y=ix.B;N=g.M(Y);b=N.next().value;m=N.next().value;O=N.next().value;F=N.next().value;y=N.next().value;p=N.next().value;n=b;D=m;h=O;X=F;d=y;z=p;if(!n&&!D){ix.bX(3);break}u=n?Fx(n.thumbnail):[];if(!D){x4=[];ix.bX(4);break}return g.I(ix,B_V(D,d),5);case 5:x4=ix.B;case 4:return iB=x4,g.I(ix,oZ(u.concat(iB)),3);case 3:qP=[];rq=g.u$(q,"downloadStatusEntity");G=g.M(z);for(yn=G.next();!yn.done;yn=G.next())nX=yn.value,fX=g.l$(nX.key).entityId,SP=ch(nX),rQ=g.l$(SP.action.entityKey).entityId,fX!==q&&rQ!==
q||mu(t,nX.actionProto)||qP.push(nX.key);return g.I(ix,wu(J,{mode:"readwrite",HK:!0},function(S){var RC=qP.map(function(lx){return Ly(S,lx)});
RC.push(Ly(S,H,{XY:!0}));RC.push(Ly(S,rq,{XY:!0}));return g.y6.all(RC)}),7);
case 7:Di=(Qn=X)==null?void 0:Qn.offlineModeType,k&&(vh(k),k.offlineModeType&&(Di=k.offlineModeType)),O4(h,Di),ig(x,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.oC(ix)}})},IFo=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL,Qa,FB,KX,XB,Bt,Q,B,A,P,e,sV,th,cC;
return g.U(function(k4){switch(k4.D){case 1:return k=g.u$(q,"mainPlaylistEntity"),H=g.u$(q,"ytMainChannelEntity"),g.I(k4,wu(J,{mode:"readonly",HK:!0},function(Ah){return g.y6.all([Wp(Ah,k,"mainPlaylistEntity"),Wp(Ah,H,"ytMainChannelEntity"),du(Ah,"mainPlaylistEntity"),du(Ah,"mainDownloadsListEntity"),du(Ah,"ytMainChannelEntity"),du(Ah,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=k4.B;r=g.M(v);C=r.next().value;Y=r.next().value;N=r.next().value;b=r.next().value;m=r.next().value;O=r.next().value;F=C;y=Y;p=N;n=b;D=m;h=O;if(!F&&!y){k4.bX(3);break}X=F?AJN(F):[];if(!y){d=[];k4.bX(4);break}return g.I(k4,B_V(y,D),5);case 5:d=k4.B;case 4:return z=d,g.I(k4,oZ(X.concat(z)),3);case 3:u=[];x4=new Map;if(!F){k4.bX(7);break}return g.I(k4,$z5(F,p,n),8);case 8:u=k4.B;iB=g.M(u);for(qP=iB.next();!qP.done;qP=iB.next())rq=qP.value,x4.set(rq,{videoId:rq,playlistId:q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.I(k4,wu(J,{mode:"readonly",HK:!0},function(Ah){return g.y6.all([du(Ah,"transfer"),du(Ah,"videoDownloadContextEntity")])}),9);
case 9:G=k4.B;yn=g.M(G);nX=yn.next().value;fX=yn.next().value;SP=nX;rQ=fX;Qn=g.M(SP);for(Di=Qn.next();!Di.done;Di=Qn.next())ix=Di.value,S=g.l$(ix.key).entityId,(RC=x4.get(S))&&ix&&(RC.cotn=ix.cotn);lx=g.M(rQ);for(yL=lx.next();!yL.done;yL=lx.next())Qa=yL.value,FB=g.l$(Qa.key).entityId,(KX=x4.get(FB))&&Qa&&(KX.offlineModeType=Qa.offlineModeType);case 7:XB=[];Bt=g.M(h);for(Q=Bt.next();!Q.done;Q=Bt.next())B=Q.value,A=g.l$(B.key).entityId,P=ch(B),A!==q&&P.rootActionId!==q||mu(t,B.actionProto)||XB.push(B.key);
e=g.u$(q,"mainPlaylistEntity");return g.I(k4,wu(J,{mode:"readwrite",HK:!0},function(Ah){var zW=XB.map(function(pN){return Ly(Ah,pN)});
zW.push(Ly(Ah,e,{XY:!0}));return g.y6.all(zW)}),10);
case 10:if(!F){k4.bX(0);break}u.reverse();if(!u){k4.bX(0);break}sV=g.M(u);th=sV.next();case 13:if(th.done){k4.bX(0);break}cC=th.value;return g.I(k4,y3(cC,J,t,x,x4.get(cC)),14);case 14:th=sV.next(),k4.bX(13)}})},XIt=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m;
return g.U(function(O){if(O.D==1)return k=g.u$("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),H=new Map,g.I(O,wu(q,{mode:"readwrite",HK:!0},function(F){var y=du(F,"transfer"),p=du(F,"offlineOrchestrationActionWrapperEntity"),n=du(F,"videoDownloadContextEntity"),D=Wp(F,k,"mainDownloadsListEntity");return g.y6.all([y,p,n,D]).then(function(h){h=g.M(h);var X=h.next().value;var d=h.next().value;var z=h.next().value;var u=h.next().value;h=hg0.map(function(iB){return Q60(F,iB)});
d=g.M(d);for(var x4=d.next();!x4.done;x4=d.next())x4=x4.value,mu(J,x4.actionProto)||h.push(Ly(F,x4.key,{XY:!0}));u&&(u.downloads=[],h.push(eC(F,u,"mainDownloadsListEntity")));if(z)for(z=g.M(z),u=z.next();!u.done;u=z.next())u=u.value,d=g.l$(u.key).entityId,d=g.u$(d,"transfer"),H.set(d,u.offlineModeType);return g.y6.all(h).then(function(){return X})})}),2);
v=O.B;r=g.M(v);for(C=r.next();!C.done;C=r.next())Y=C.value,O4(Y,H.get(Y.key)),N=g.l$(Y.key).entityId,b={videoId:N,offlineDeleteReason:x,cotn:Y.cotn,offlineModeType:H.get(Y.key)},vh(b),m=g.u$(N,"mainVideoEntity"),ig(t,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.I(O,QSx(),0)})},AJN=function(q,J){var t=[];
if(q.thumbnailStyleData){q=g.M(q.thumbnailStyleData);for(var x=q.next();!x.done;x=q.next()){var k=void 0,H=void 0,v=void 0;t=t.concat(Fx((k=x.value)==null?void 0:(H=k.value)==null?void 0:(v=H.collageThumbnail)==null?void 0:v.coverThumbnail))}}J=Fx(J);return t.concat(J)},$z5=function(q,J,t){var x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB;
return g.U(function(qP){x=[];k=new Set;if(t.length)for(H=g.M(t),v=H.next();!v.done;v=H.next())if(r=v.value,C=void 0,(C=r.downloads)==null?0:C.length)for(Y=g.M(r.downloads),N=Y.next();!N.done;N=Y.next())b=N.value,b.videoItem&&(m=g.l$(b.videoItem).entityId,k.add(m));if(q.videos){O=g.M(q.videos);for(F=O.next();!F.done;F=O.next())y=F.value,p=JSON.parse(g.l$(y).entityId),p.videoId&&!k.has(p.videoId)&&x.push(p.videoId);n=g.M(J);for(D=n.next();!D.done;D=n.next())if(h=D.value,h.key!==q.key&&(X=h.videos))for(d=
g.M(X),z=d.next();!z.done;z=d.next())u=z.value,x4=JSON.parse(g.l$(u).entityId),x4.videoId&&(iB=x.indexOf(x4.videoId),iB!==-1&&x.splice(iB,1))}return qP.return(x)})},B_V=function(q,J){var t,x,k,H,v,r,C,Y;
return g.U(function(N){t=Fx(q.avatar);x=g.M(J);for(k=x.next();!k.done;k=x.next())if(H=k.value,H.id!==q.id)for(v=g.M(Fx(H.avatar)),r=v.next();!r.done;r=v.next())C=r.value,Y=t.indexOf(C),Y!==-1&&t.splice(Y,1);return N.return(t)})},Pnu=function(q){var J;
return g.U(function(t){J=g.f(q.frameworkUpdates,p0);return q.frameworkUpdates&&J?g.I(t,dgo(J),0):t.return()})},T_V=function(q){var J;
if((J=q.onResponseReceivedActions)!=null&&J.length){var t;q=(t=g.f(g.f(q.onResponseReceivedActions[0],Uzx),g.u4Q))==null?void 0:t.actions;if(q!=null&&q.length)return q}},jSt=function(q){var J,t,x;
return g.U(function(k){if(k.D==1)return q?g.I(k,zL(q,g.$6,"mainDownloadsListEntity"),2):k.return([]);J=k.B;return((t=J)==null?0:(x=t.downloads)==null?0:x.length)?k.return(J.downloads.map(function(H){var v;return(v=H.videoItem)!=null?v:""})):k.return([])})},W3t=function(q,J){var t;
return g.U(function(x){return x.D==1?g.I(x,K3P(q,J),2):(t=x.B)?g.I(x,wu(q,{mode:"readwrite",HK:!0},function(k){var H=[eC(k,t.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];t.mainDownloadsListEntity&&H.push(eC(k,t.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.y6.all(H)}),0):x.bX(0)})},K3P=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h;
return g.U(function(X){if(X.D==1)return t=g.u$("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.u$("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.I(X,wu(q,{mode:"readonly",HK:!0},function(d){return g.y6.all([Wp(d,t,"mainDownloadsLibraryEntity"),Wp(d,x,"mainDownloadsListEntity")])}),2);
k=X.B;H=g.M(k);v=H.next().value;r=H.next().value;C=v;Y=r;C||(C={id:t});N=g.M(J);for(b=N.next();!b.done;b=N.next())if(m=b.value,m===g.$6){if(C.smartDownloadsList)return X.return();C.smartDownloadsList=m}else if(O=g.l$(m).entityType,F={},O==="mainPlaylistEntity"?F.playlistItem=m:O==="mainVideoEntity"&&(F.videoItem=m),!g.GQ(F)){y=void 0;if((y=Y)==null?0:y.downloads){p=!1;n=g.M(Y.downloads);for(D=n.next();!D.done;D=n.next())if(h=D.value,h.playlistItem===m||h.videoItem===m){p=!0;break}p||Y.downloads.push(F)}else Y=
{id:x,downloads:[F]};C.downloadsList=x}return X.return({mainDownloadsLibraryEntity:C,mainDownloadsListEntity:Y})})},dzN=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p;
return g.U(function(n){if(n.D==1)return t=g.u$("main_downloads_library_id","mainDownloadsLibraryEntity"),x=g.u$("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.I(n,wu(q,{mode:"readonly",HK:!0},function(D){return g.y6.all([Wp(D,t,"mainDownloadsLibraryEntity"),Wp(D,x,"mainDownloadsListEntity"),Wp(D,g.$6,"mainDownloadsListEntity")])}),2);
k=n.B;H=g.M(k);v=H.next().value;r=H.next().value;C=H.next().value;Y=v;N=r;b=C;if(!Y)return n.bX(0);if(J===g.$6&&((m=b)==null?0:m.downloads))b.downloads=[];else if((O=N)==null?0:O.downloads)for(F=g.l$(J).entityType,y=0;y<N.downloads.length;y++)if(p=N.downloads[y],F==="mainVideoEntity"&&p.videoItem===J){N.downloads.splice(y,1);break}else if(F==="mainPlaylistEntity"&&p.playlistItem===J){N.downloads.splice(y,1);break}return g.I(n,wu(q,{mode:"readwrite",HK:!0},function(D){var h=[eC(D,Y,"mainDownloadsLibraryEntity")];
N&&h.push(eC(D,N,"mainDownloadsListEntity"));b&&h.push(eC(D,b,"mainDownloadsListEntity"));return g.y6.all(h)}),0)})},s4=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m;
return g.U(function(O){if(O.D==1)return t=g.u$(J,"transfer"),x=g.u$(J,"videoDownloadContextEntity"),g.I(O,wu(q,{mode:"readonly",HK:!0},function(F){return g.y6.all([Wp(F,t,"transfer"),Wp(F,x,"videoDownloadContextEntity")])}),2);
k=O.B;H=g.M(k);v=H.next().value;r=H.next().value;C=v;Y=r;m={videoId:J,cotn:(N=C)==null?void 0:N.cotn,offlineModeType:(b=Y)==null?void 0:b.offlineModeType};return O.return(m)})},Sb=function(q,J,t,x,k){var H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4;
return g.U(function(iB){switch(iB.D){case 1:return H=g.u$(q,"musicTrack"),v=g.u$(q,"transfer"),g.I(iB,wu(J,{mode:"readonly",HK:!0},function(qP){return g.y6.all([Wp(qP,H,"musicTrack"),Wp(qP,v,"transfer"),du(qP,"musicTrack"),du(qP,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=iB.B;C=g.M(r);Y=C.next().value;N=C.next().value;b=C.next().value;m=C.next().value;O=Y;F=N;y=b;p=m;if(!O){iB.bX(3);break}return g.I(iB,fFZ(O,y),4);case 4:return n=iB.B,g.I(iB,oZ(n),3);case 3:D=[];h=g.M(p);for(X=h.next();!X.done;X=h.next())d=X.value,z=g.l$(d.key).entityId,u=ch(d),x4=g.l$(u.action.entityKey).entityId,z!==q&&x4!==q||mu(t,d.actionProto)||D.push(d.key);return g.I(iB,wu(J,{mode:"readwrite",HK:!0},function(qP){var rq=D.map(function(G){return Ly(qP,G)});
rq.push(Ly(qP,H,{XY:!0}));return g.y6.all(rq)}),6);
case 6:O4(F),k&&vh(k),ig(x,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.oC(iB)}})},Dy=function(q,J,t,x,k){var H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL;
return g.U(function(Qa){switch(Qa.D){case 1:return H=g.u$(q,J),v=g.u$("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(Qa,wu(t,{mode:"readonly",HK:!0},function(FB){return g.y6.all([Wp(FB,H,J),Wp(FB,v,"musicDownloadsLibraryEntity"),du(FB,J),du(FB,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=Qa.B;C=g.M(r);Y=C.next().value;N=C.next().value;b=C.next().value;m=C.next().value;O=Y;F=N;y=b;p=m;if(!O){Qa.bX(3);break}return g.I(Qa,fFZ(O,y),4);case 4:return n=Qa.B,g.I(Qa,oZ(n),3);case 3:D=[];h=new Map;if(!O){Qa.bX(6);break}return g.I(Qa,egu(O,y,F),7);case 7:D=Qa.B;X=g.M(D);for(d=X.next();!d.done;d=X.next())z=d.value,u=g.l$(z).entityId,h.set(u,{videoId:u,playlistId:q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.I(Qa,GL(t,"transfer"),8);case 8:for(x4=Qa.B,iB=
g.M(x4),qP=iB.next();!qP.done;qP=iB.next())rq=qP.value,G=g.l$(rq.key).entityId,(yn=h.get(G))&&rq&&(yn.cotn=rq.cotn);case 6:nX=[];fX=g.M(p);for(SP=fX.next();!SP.done;SP=fX.next())rQ=SP.value,Qn=g.l$(rQ.key).entityId,Di=ch(rQ),Qn!==q&&Di.rootActionId!==q||mu(x,rQ.actionProto)||nX.push(rQ.key);ix=g.u$(q,J);return g.I(Qa,wu(t,{mode:"readwrite",HK:!0},function(FB){var KX=nX.map(function(XB){return Ly(FB,XB)});
KX.push(Ly(FB,ix,{XY:!0}));return g.y6.all(KX)}),9);
case 9:if(!O){Qa.bX(0);break}D.reverse();if(!D.length){Qa.bX(0);break}S=g.M(D);RC=S.next();case 12:if(RC.done){Qa.bX(0);break}lx=RC.value;yL=g.l$(lx).entityId;if(!yL){Qa.bX(13);break}return g.I(Qa,Sb(yL,t,x,k,h.get(yL)),13);case 13:RC=S.next(),Qa.bX(12)}})},n0=function(q,J,t){var x,k,H,v,r,C,Y;
return g.U(function(N){if(N.D==1)return g.I(N,wu(q,{mode:"readwrite",HK:!0},function(b){var m=du(b,"transfer"),O=du(b,"offlineOrchestrationActionWrapperEntity");return g.y6.all([m,O]).then(function(F){F=g.M(F);var y=F.next().value;var p=F.next().value;F=L3x.map(function(X){return Q60(b,X)});
p=g.M(p);for(var n=p.next();!n.done;n=p.next()){n=n.value;var D=g.l$(n.actionProto.entityKey).entityType==="musicTrack",h=n.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";mu(J,n.actionProto)||D&&(!D||h)||F.push(Ly(b,n.key,{XY:!0}))}return g.y6.all(F).then(function(){return y})})}),2);
x=N.B;k=g.M(x);for(H=k.next();!H.done;H=k.next())v=H.value,O4(v),r=g.l$(v.key).entityId,C={videoId:r,offlineDeleteReason:void 0,cotn:v.cotn},vh(C),Y=g.u$(r,"musicTrack"),ig(t,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.I(N,QSx(),0)})},lFa=function(q){for(var J,t=g.M(q.additionalMetadatas),x=t.next();!x.done;x=t.next())x=x.value,x.offlineMusicVideoData&&(J=x.offlineMusicVideoData);
var k,H,v,r,C;return{id:g.u$(q.videoId,"musicTrack"),videoId:q.videoId,title:q.title,thumbnailDetails:q.thumbnail,lengthMs:String(Number(q.lengthSeconds)*1E3),albumTitle:(k=J)==null?void 0:k.releaseTitle,musicVideoType:(H=J)==null?void 0:H.musicVideoType,contentRating:{explicitType:(v=J)==null?void 0:v.explicitType},artistNames:((r=J)==null?void 0:r.byline)||((C=J)==null?void 0:C.channelName),downloadMetadata:g.u$(q.videoId,"musicTrackDownloadMetadataEntity")}},egu=function(q,J,t){var x,k,H,v,r,C,
Y,N,b,m,O,F,y,p,n,D,h,X;
return g.U(function(d){x=[];k=new Set;if((H=t)==null?0:(v=H.downloadedTracks)==null?0:v.length)for(r=g.M(t.downloadedTracks),C=r.next();!C.done;C=r.next())Y=C.value,k.add(Y);if(q.tracks){N=g.M(q.tracks);for(b=N.next();!b.done;b=N.next())m=b.value,k.has(m)||x.push(m);O=g.M(J);for(F=O.next();!F.done;F=O.next())if(y=F.value,y.id!==q.id&&(p=y.tracks))for(n=g.M(p),D=n.next();!D.done;D=n.next())h=D.value,X=x.indexOf(h),X!==-1&&x.splice(X,1)}return d.return(x)})},fFZ=function(q,J){var t,x,k,H,v,r,C,Y;
return g.U(function(N){t=Fx(q.thumbnailDetails);x=g.M(J);for(k=x.next();!k.done;k=x.next())if(H=k.value,H.id!==q.id)for(v=g.M(Fx(H.thumbnailDetails)),r=v.next();!r.done;r=v.next())C=r.value,Y=t.indexOf(C),Y!==-1&&t.splice(Y,1);return N.return(t)})},u3x=function(q,J){var t,x,k,H,v,r,C,Y,N;
return g.U(function(b){if(b.D==1)return t=g.u$("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(b,zL(q,t,"musicDownloadsLibraryEntity"),2);(x=b.B)||(x={id:t});k=g.l$(J).entityType;k==="musicTrack"?(H=x.downloadedTracks)!=null&&H.includes(J)||(x.downloadedTracks=((v=x.downloadedTracks)!=null?v:[]).concat(J)):k==="musicPlaylist"?(r=x.downloadedPlaylists)!=null&&r.includes(J)||(x.downloadedPlaylists=((C=x.downloadedPlaylists)!=null?C:[]).concat(J)):k!=="musicAlbumRelease"||(Y=x.downloadedAlbumReleases)!=
null&&Y.includes(J)||(x.downloadedAlbumReleases=((N=x.downloadedAlbumReleases)!=null?N:[]).concat(J));return g.I(b,Vu(q,x,"musicDownloadsLibraryEntity"),0)})},wIu=function(q,J){var t,x,k,H,v,r,C;
return g.U(function(Y){if(Y.D==1)return t=g.u$("music_downloads_library_id","musicDownloadsLibraryEntity"),g.I(Y,zL(q,t,"musicDownloadsLibraryEntity"),2);x=Y.B;if(!x)return Y.bX(0);k=g.l$(J).entityType;k==="musicTrack"?H=x.downloadedTracks:k==="musicPlaylist"&&(H=x.downloadedPlaylists);if((v=H)==null?0:v.length)for(r=0;r<H.length;r++)if(C=H[r],C===J){H.splice(r,1);break}return g.I(Y,Vu(q,x,"musicDownloadsLibraryEntity"),0)})},VxQ=function(q){var J=q.videos;
q=[];var t=[];if(J){J=g.M(J);for(var x=J.next();!x.done;x=J.next()){var k=x.value.offlineVideoData.videoId;x=g.u$(k,"musicTrack");k=g.u$(k,"musicTrackDownloadMetadataEntity");q.push(x);t.push(k)}}return{Gk:q,Ex:t}},Zy=function(q,J,t){J={track:lFa(J)};
t&&(J.playlistId=t);if(q=g.f(q.actionMetadata,zg5))J.maximumDownloadQuality=q.maximumDownloadQuality;return{musicTrackEntityActionMetadata:J}},aFQ=function(q){var J,t,x,k,H,v,r,C;
return g.U(function(Y){switch(Y.D){case 1:return J=g.t3(),t=zLt(q),x=g.GI(GbN),g.gq(Y,2),H={I6:!0},g.I(Y,g.eM(J,t,x,void 0,H),4);case 4:k=Y.B;g.St(Y,3);break;case 2:v=g.Zi(Y);if(v instanceof g.a$)throw r="GetOffline network manager error: "+v.message,xa(r,v),Error(r);xa("GetOffline fetch request error",v);throw Error("GetOffline fetch request error");case 3:C=Q3(k);if(!k)throw xa("Network request failed"),Error("Network request failed");if(C!==void 0)Bh(C);else if(!k.videos||!k.videos.length)throw xa("No data"),
Error("No data");return Y.return(k.videos.map(function(N){return N.offlineVideoData}))}})},qUx=function(q){var J,t,x,k,H,v,r,C;
return g.U(function(Y){switch(Y.D){case 1:return J=g.t3(),t=GaP(q),x=g.GI(GbN),g.gq(Y,2),H={I6:!0},g.I(Y,g.eM(J,t,x,void 0,H),4);case 4:k=Y.B;g.St(Y,3);break;case 2:v=g.Zi(Y);if(v instanceof g.a$)throw r="GetOffline network manager error for playlist: "+v.message,xa(r,v),Error(r);xa("GetOffline fetch request error for playlist",v);throw Error("GetOffline fetch request error for playlist");case 3:C=Q3(k);if(!k)throw xa("Network request failed for playlist"),Error("Network request failed for playlist");
if(C!==void 0)Bh(C,"playlist");else if(!k.playlists||!k.playlists.length)throw xa("No data for playlist"),Error("No data for playlist");return Y.return(k.playlists.map(function(N){return N.offlinePlaylistData}))}})},tHB=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ;
return g.U(function(Qn){switch(Qn.D){case 1:return g.I(Qn,at(),2);case 2:k=Qn.B;if(!k)return Qn.return([]);H=[];if((v=x)==null?0:v.length){H=x;Qn.bX(3);break}return g.I(Qn,GL(k,"mainPlaylistEntity"),4);case 4:H=Qn.B;case 3:if(!H.length)return Qn.return([]);r=[];C=Date.now()/1E3;Y=g.M(H);N=Y.next();case 5:if(N.done)return r.length?g.I(Qn,Jqt(r),10):Qn.return([]);b=N.value;if(!b.downloadState){m=void 0;Qn.bX(8);break}return g.I(Qn,zL(k,b.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:m=
Qn.B;case 8:O=m;F=void 0;p=(y=(F=b)==null?void 0:F.entityMetadata)&&y.nextAutoRefreshIntervalSeconds?Number(y.nextAutoRefreshIntervalSeconds):NaN;n=Number.isNaN(p)?q:p;h=D=void 0;X=((D=O)==null?0:D.lastSyncedTimestampMillis)?Number((h=O)==null?void 0:h.lastSyncedTimestampMillis)/1E3:0;z=d=void 0;u=((d=O)==null?0:d.addedTimestampMillis)?Number((z=O)==null?void 0:z.addedTimestampMillis)/1E3:0;if(t||!y||X+n<=C){x4=[];iB=void 0;if((iB=b.videos)==null?0:iB.length)for(qP=g.M(b.videos),rq=qP.next();!rq.done;rq=
qP.next())G=rq.value,yn=JSON.parse(g.l$(G).entityId),yn.videoId&&x4.push(yn.videoId);nX="0";y&&(fX=void 0,nX=String(Number((fX=y.offlineLastModifiedTimestampSeconds)!=null?fX:0).toFixed()));SP={playlistId:b.playlistId,videoIds:x4,offlineLastModifiedTimestamp:nX,autoSync:J,offlineDateAddedTimestamp:String(u.toFixed())};r.push(SP)}N=Y.next();Qn.bX(5);break;case 10:return rQ=Qn.B,Qn.return(rQ)}})},xkN=function(){var q,J,t,x,k;
return g.U(function(H){if(H.D==1)return g.I(H,at(),2);if(H.D!=3)return(q=H.B)?g.I(H,GL(q,"refresh"),3):H.return(!1);J=H.B;if((t=J[0])==null||!t.refreshTime)return H.return(!1);x=Number(J[0].refreshTime);k=Date.now()/1E3;return H.return(isFinite(x)&&k>=x)})},iCQ=function(q,J){var t,x,k;
return g.U(function(H){switch(H.D){case 1:return g.gq(H,2),g.I(H,kEN(q,J),4);case 4:return x=H.B,g.I(H,Pnu(x),5);case 5:t=T_V(x);g.St(H,3);break;case 2:k=g.Zi(H),xa("getAndProcessSmartDownloadsResponse request or processing error",k);case 3:return H.return(t)}})},HC5=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ;
return g.U(function(Qn){switch(Qn.D){case 1:return g.I(Qn,at(),2);case 2:k=Qn.B;if(!k)return Qn.return([]);H=[];if((v=x)==null?0:v.length){H=x;Qn.bX(3);break}return g.I(Qn,GL(k,"musicPlaylist"),4);case 4:H=Qn.B;case 3:if(!H.length)return Qn.return([]);r=[];C=Date.now()/1E3;Y=g.M(H);N=Y.next();case 5:if(N.done)return r.length?g.I(Qn,Jqt(r),10):Qn.return([]);b=N.value;m=void 0;F=(O=(m=b)==null?void 0:m.entityMetadata)&&O.nextAutoRefreshIntervalSeconds?Number(O.nextAutoRefreshIntervalSeconds):NaN;y=
Number.isNaN(F)?q:F;n=p=0;D="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!b.downloadMetadata){Qn.bX(8);break}return g.I(Qn,zL(k,b.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:h=Qn.B,d=X=void 0,p=Number((d=(X=h)==null?void 0:X.addedTimestampMillis)!=null?d:"0")/1E3,u=z=void 0,n=Number((u=(z=h)==null?void 0:z.lastModifiedTimestampMillis)!=null?u:"0")/1E3,iB=x4=void 0,D=(iB=(x4=h)==null?void 0:x4.syncState)!=null?iB:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:qP=void 0;if(t||D!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!O||Number((qP=O.lastSyncedTimestampSeconds)!=null?qP:0)+y<=C){rq=[];G=void 0;if((G=b.tracks)==null?0:G.length)for(yn=g.M(b.tracks),nX=yn.next();!nX.done;nX=yn.next())fX=nX.value,rq.push(g.l$(fX).entityId);SP={playlistId:b.playlistId,videoIds:rq,offlineLastModifiedTimestamp:String(n.toFixed()),autoSync:J,offlineDateAddedTimestamp:String(p.toFixed())};r.push(SP)}N=Y.next();Qn.bX(5);break;case 10:return rQ=Qn.B,Qn.return(rQ)}})},kEN=function(q,J){var t,x,k,H,v,r,C,Y,N,b;
return g.U(function(m){switch(m.D){case 1:return t=g.t3(),g.I(m,at(),2);case 2:x=m.B;if(!x){m.bX(3);break}return g.I(m,ino(x),4);case 4:k=m.B;case 3:var O=k;H={context:g.w5(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:q},offlineClientState:O,clientStateRequestData:{preferredFormatType:J}}}};v=g.GI(voa);g.gq(m,5);C={I6:!0};return g.I(m,g.eM(t,H,v,void 0,C),7);case 7:r=m.B;g.St(m,6);break;case 5:Y=g.Zi(m);if(Y instanceof g.a$)throw N=
"DPS network manager error for smart downloads: "+Y.message,xa(N,Y),Error(N);xa("DPS fetch request error for smart downloads",Y);throw Error("DPS fetch request error for smart downloads");case 6:b=Q3(r);if(r)b!==void 0&&Bh(b,"smart downloads");else throw xa("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return m.return(r)}})},rqt=function(q,J){var t,x,k,H,v,r,C,Y;
return g.U(function(N){switch(N.D){case 1:return t=g.t3(),x={context:g.w5(),videoPlaybackPositionEntities:q,lastSyncTimestampUsec:J},k=g.GI(RQP),g.gq(N,2),v={I6:!0},g.I(N,g.eM(t,x,k,void 0,v),4);case 4:H=N.B;g.St(N,3);break;case 2:r=g.Zi(N);if(r instanceof g.a$)throw C="VPPS network manager error: "+r.message,xa(C,r),Error(C);xa("VPPS fetch request error",r);throw Error("VPPS fetch request error");case 3:Y=Q3(H);if(H)Y!==void 0&&Bh(Y,"position sync");else throw xa("Network request failed for position sync"),
Error("Network request failed for position sync");return N.return(H)}})},YUa=function(q,J,t){var x,k,H,v,r,C,Y,N;
return g.U(function(b){switch(b.D){case 1:x=g.t3();var m=t.refreshData,O=t.isEnqueuedForExpiredStreamUrlRefetch,F=t.eW,y=t.offlineSourceData,p=t.mediaCapabilities,n={entityKey:q};m&&(n.refreshData=m);O&&(n.isExpiredStreamUrlRefetch=O);F&&(n.downloadParameters=F);y&&(n.offlineSourceData=y);m={context:g.aR(J),signatureTimestamp:20216,videos:[n]};p&&(m.mediaCapabilities=p);k=m;H=g.GI(C8Q);g.gq(b,2);r={I6:!0};return g.I(b,g.eM(x,k,H,void 0,r),4);case 4:v=b.B;g.St(b,3);break;case 2:C=g.Zi(b);if(C instanceof
g.a$)throw Y="GetPDE network manager error: "+C.message,xa(Y,C),Error(Y);xa("GetPDE fetch request error",C);throw Error("GetPDE fetch request error");case 3:N=Q3(v);if(v)N!==void 0&&Bh(N,"PDE");else throw xa("Network request failed for PDE"),Error("Network request failed for PDE");return b.return(v)}})},Q3=function(q){var J;
return(J=q.errorMetadata)==null?void 0:J.status},Bh=function(q,J){J=J?" for "+J:"";
if(q===0)throw q="Empty response body"+J,xa(q),Error(q);q="Response with error"+J;xa(q);throw Error(q);},Jqt=function(q){var J,t,x,k,H,v,r,C;
return g.U(function(Y){switch(Y.D){case 1:return J=g.t3(),t=aT5(q),x=g.GI(NGo),g.gq(Y,2),H={I6:!0},g.I(Y,g.eM(J,t,x,void 0,H),4);case 4:k=Y.B;g.St(Y,3);break;case 2:v=g.Zi(Y);if(v instanceof g.a$)throw r="offlinePlaylistSyncCheck network manager error: "+v.message,xa(r,v),Error(r);xa("offlinePlaylistSyncCheck fetch request error",v);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:C=Q3(k);if(!k)throw xa("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(C!==void 0)Bh(C,"playlist sync");else if(!k.offlinePlaylistSyncCheckDatas||!k.offlinePlaylistSyncCheckDatas.length)throw xa("No data for playlist sync"),Error("No data for playlist sync");return Y.return(k.offlinePlaylistSyncCheckDatas.map(function(N){return N.offlinePlaylistSyncCheckData}))}})},Az=function(q){this.B=q},bCZ=function(q,J){var t,x,k,H,v,r;
return g.U(function(C){switch(C.D){case 1:t=new Map,x=g.M(J),k=x.next();case 2:if(k.done){C.bX(4);break}H=k.value;v=t;r=v.set;return g.I(C,q.D(H),5);case 5:r.call(v,H,C.B);k=x.next();C.bX(2);break;case 4:return C.return(t)}})},$a=function(q,J,t,x,k,H){J=g.u$(J,t);
x=Object.assign({},H,{priority:x,retryScheduleIntervalsInSeconds:k});return{actionType:q,entityKey:J,actionMetadata:x}},IZ=function(q,J,t,x,k,H){this.status=q;
this.B=J;this.Y=t;this.D=x;this.C=k;this.downloadState=H},mkB=function(q,J,t){this.B=q;
this.lX=J;this.C=t},EoZ=function(q,J){var t,x,k,H,v,r,C,Y,N;
return g.U(function(b){switch(b.D){case 1:return t=J.entityKey,k=(x=g.f(J.actionMetadata,hz))==null?void 0:x.isEnqueuedForExpiredStreamUrlRefetch,g.gq(b,2),H=void 0,g.I(b,OCD(q,J),4);case 4:H=b.B;g.gq(b,5);var m=(m=g.f(J.actionMetadata,hz))?{maximumDownloadQuality:m.maximumDownloadQuality}:void 0;return g.I(b,YUa(t,q.lX,{isEnqueuedForExpiredStreamUrlRefetch:k,eW:m,offlineSourceData:H}),7);case 7:v=b.B;g.St(b,6,2);break;case 5:return g.Zi(b,2),r=rT(J)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",xa("PDE handleAdd error"),b.return(Xx(J,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",r,"DOWNLOAD_STATE_FAILED"));case 6:return g.I(b,F8P(q,v,J),8);case 8:return b.return(Xx(J,!0,v.orchestrationActions));case 2:return C=g.Zi(b),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.OQ&&C.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),xa("PDE handleAdd error"),b.return(Xx(J,!1,void 0,Y,N,"DOWNLOAD_STATE_FAILED"))}})},oox=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB;
return g.U(function(qP){switch(qP.D){case 1:return t=J.entityKey,x=g.l$(t).entityId,g.I(qP,wu(q.B,{mode:"readonly",HK:!0},function(rq){var G=Wp(rq,t,"playbackData"),yn=Wp(rq,g.u$(x,"offlineVideoPolicy"),"offlineVideoPolicy");rq=Wp(rq,g.u$(x,"transfer"),"transfer");return g.y6.all([G,yn,rq])}),2);
case 2:k=qP.B;H=g.M(k);v=H.next().value;r=H.next().value;C=H.next().value;Y=v;N=r;b=C;if(!Y||!N)return qP.return(Xx(J,!0));m=[];y=((F=Y)==null?0:F.playerResponseJson)?JSON.parse(Y.playerResponseJson):null;if(!(b&&y&&q.lX.G("html5_refresh_deprecated_downloads"))){qP.bX(3);break}O=cqx(q,y,b);return g.I(qP,MHt(q,b),4);case 4:m=qP.B;case 3:p={lastPlayerResponseTimestampSeconds:Y.playerResponseTimestamp,offlineToken:N.offlineToken,formatIds:m};n={};if((D=b)==null?0:D.maximumDownloadQuality)n.maximumDownloadQuality=
b.maximumDownloadQuality;g.gq(qP,5);h=void 0;return g.I(qP,OCD(q,J),7);case 7:return h=qP.B,g.gq(qP,8),g.I(qP,YUa(t,q.lX,{refreshData:p,eW:n,offlineSourceData:h,mediaCapabilities:O}),10);case 10:X=qP.B;g.St(qP,9,5);break;case 8:return g.Zi(qP,5),d=rT(J)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",xa("PDE handleRefresh error"),qP.return(Xx(J,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",d,
"DOWNLOAD_STATE_FAILED"));case 9:return g.I(qP,F8P(q,X,J),11);case 11:return qP.return(Xx(J,!0,X.orchestrationActions));case 5:return z=g.Zi(qP),u="PDE handleRefresh error",z instanceof Error&&(u="PDE handleRefresh error: "+z.message),x4="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",iB="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.OQ&&z.type==="QUOTA_EXCEEDED"&&(x4="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",iB="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
xa(u),qP.return(Xx(J,!1,void 0,x4,iB,"DOWNLOAD_STATE_FAILED"))}})},OCD=function(q,J){var t,x,k,H;
return g.U(function(v){if(v.D==1)return t=g.l$(J.entityKey).entityId,x=g.u$(t,"videoDownloadContextEntity"),g.I(v,zL(q.B,x,"videoDownloadContextEntity"),2);k=v.B;return(H=k)!=null&&H.offlineModeType?v.return({offlineModeType:k.offlineModeType}):v.return(void 0)})},F8P=function(q,J,t){var x,k,H,v,r;
return g.U(function(C){if(C.D==1){if(!J.frameworkUpdates||!g.f(J.frameworkUpdates,p0))return C.return();if(!(g.f(J.frameworkUpdates,p0).mutations&&g.f(J.frameworkUpdates,p0).mutations.length>0&&g.f(J.frameworkUpdates,p0).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return C.bX(2);x=g.l$(g.f(J.frameworkUpdates,p0).mutations[0].entityKey).entityId;return g.I(C,s4(q.B,x),3)}if(C.D!=2){k=C.B;H=g.f(t.actionMetadata,hz);if(r=(v=H)==null?void 0:v.playlistId)k.playlistId=r;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ww(q.lX)?g.I(C,y3(x,q.B,t,q.C,k),2):g.X2(q.lX)?g.I(C,Sb(x,q.B,t,q.C),2):C.bX(2)}return g.I(C,dgo(g.f(J.frameworkUpdates,p0)),0)})},Xx=function(q,J,t,x,k,H){return new IZ(J?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",rT(q),t,x,k,H)},cqx=function(q,J,t){J=nKZ(q.lX,t.cotn,J);
t=g.RR(J);return g.JSq(J,t,q.lX)},MHt=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m;
return g.U(function(O){if(O.D==1)return t=[],g.I(O,wu(q.B,{mode:"readonly",HK:!0},function(F){var y=[],p=J.offlineVideoStreams;if(p){p=g.M(p);for(var n=p.next();!n.done;n=p.next())y.push(Wp(F,n.value,"offlineVideoStreams"))}return g.y6.all(y)}),2);
if(x=O.B)for(k=g.M(x),H=k.next();!H.done;H=k.next())if(v=H.value,r=void 0,(r=v)==null?0:r.streamsProgress)for(C=v.streamsProgress,Y=0;Y<C.length;Y++)N=C[Y],b=JSON.parse(N.formatStreamBytes),m={itag:b.itag,lmt:b.lastModified,xtags:b.xtags},t.push(m);return O.return(t)})},goB=function(q,J){this.B=q;
this.lX=J},yqu=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O;
return g.U(function(F){switch(F.D){case 1:return t=rT(J),g.I(F,GL(q.B,"videoPlaybackPositionEntity"),2);case 2:x=F.B;if(x.length===0)return F.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.gq(F,3);return g.I(F,TL.getInstance(),5);case 5:k=F.B;if(!k)throw Error("prefStorage is undefined");return g.I(F,k.get("psi"),6);case 6:return H=F.B,C=(r=(v=H)==null?void 0:v.Wi)!=null?r:"0",g.I(F,rqt(x,C),7);case 7:return Y=F.B,N={isPaused:Y.watchHistoryPaused,Wi:Y.syncTimestampUsec},g.I(F,k.set("psi",
N),8);case 8:if(N.isPaused){F.bX(9);break}b=g.f(Y.frameworkUpdates,p0);if(!Y.frameworkUpdates||!b){F.bX(9);break}return g.I(F,dgo(b),9);case 9:g.St(F,4);break;case 3:return m=g.Zi(F),O="PPE handleRefresh error: "+(m instanceof Error?m.message:"unknown error"),xa(O),F.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},sl5=function(q,J){var t,x,k,H,v,r,C,Y;
return g.U(function(N){switch(N.D){case 1:return t=rT(J),x=g.l$(J.entityKey).entityId,g.gq(N,2),g.I(N,TL.getInstance(),4);case 4:k=N.B;if(!k)throw Error("prefStorage is undefined");return g.I(N,k.get("psi"),5);case 5:H=N.B;v=g.f(J.actionMetadata,p75);if(((r=H)==null?void 0:r.isPaused)!==!1||(C=v)==null||!C.lastPlaybackPositionSeconds){N.bX(6);break}Y={key:g.u$(x,"videoPlaybackPositionEntity"),videoId:x,lastPlaybackPositionSeconds:v.lastPlaybackPositionSeconds};return g.I(N,Vu(q.B,Y,"videoPlaybackPositionEntity"),
6);case 6:g.St(N,3);break;case 2:return g.Zi(N),N.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},SUV=function(q,J){var t,x,k;
return g.U(function(H){switch(H.D){case 1:t=rT(J);g.gq(H,2);x=g.l$(J.entityKey).entityId;if(x==="!*$_ALL_ENTITIES_!*$")return g.I(H,Ug5(q.B),5);k=g.u$(x,"videoPlaybackPositionEntity");return g.I(H,PFB(q.B,k),5);case 5:g.St(H,3);break;case 2:return g.Zi(H),H.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},Dkt=function(q,J){this.api=q;
this.B=J;this.logger=new g.xx("woffle");this.D=!1;this.BW={yc:this.yc};this.logger.debug("Initialized OfflineMediaManager")},noQ=function(q){return g.U(function(J){return J.return(VIa(q))})},ZCo=function(q){var J;
return g.U(function(t){if(t.D==1)return g.I(t,g.gnC(q),2);J=t.B;return t.return(J.filter(function(x){return!!x.url}).map(function(x){return x.url}))})},Ph=function(q,J){var t=g.B8(J);
if(t===1||t===0)return Promise.resolve();(t=Qlo(q,J))&&t.stopVideo();q.C=0;return noQ(J)},U4=function(q,J,t,x){t=t===void 0?!1:t;
x=x===void 0?!0:x;var k=typeof J==="string"?J:J.videoDetails.videoId;g.B8(k)===2&&((J=Qlo(q,k))?J.stopVideo():q.logger.info(function(){return"Corresponding player for "+k+" not found. Pausing anyway"}),g.AQ(k,2),q.C=2,t?BGD(q.B):x&&Aqu(q.B))},Qlo=function(q,J){var t;
return((t=q.player)==null?void 0:t.getVideoData().videoId)===J?q.player:null},$kQ=function(q,J,t){J.getPlayerResponse();
g.AQ(J.videoId,2);q.C=2;q.D=!1;var x;(x=q.player)==null||x.dispose();q.player=q.api.le(J);J={};q.player.vc((J.localmediachange=q.jd,J.signatureexpired=q.JF,J.statechange=q.ecw,J),q);var k=q.yc(t);q.player.QM(g.rB(k,k,!0,"m"),!1);q.logger.debug(function(){return"Starting headless playback with quality: "+k});
q.player.K2(!1)},IZQ=function(q,J){this.B=q;
this.lX=J},X70=function(q,J){var t,x;
return g.U(function(k){switch(k.D){case 1:return t=rT(J),g.I(k,zL(q.B,J.entityKey,"transfer"),2);case 2:if(x=k.B)return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.gq(k,3);return g.I(k,hQx(q,J),5);case 5:g.St(k,4);break;case 3:return g.Zi(k),k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},P8o=function(q,J){var t,x;
return g.U(function(k){switch(k.D){case 1:return t=rT(J),g.I(k,zL(q.B,J.entityKey,"transfer"),2);case 2:x=k.B;if(!x||x.transferState!=="TRANSFER_STATE_COMPLETE")return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.gq(k,3);return g.I(k,hQx(q,J,!0),5);case 5:g.St(k,4);break;case 3:return g.Zi(k),k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},UkQ=function(q,J){var t,x,k,H,v,r,C,Y,N,b;
return g.U(function(m){switch(m.D){case 1:return t=rT(J),x=g.l$(J.entityKey).entityId,g.I(m,wu(q.B,{mode:"readonly",HK:!0},function(O){var F=Wp(O,J.entityKey,"transfer");O=Wp(O,g.u$(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.y6.all([F,O])}),2);
case 2:k=m.B;H=g.M(k);v=H.next().value;r=H.next().value;C=v;Y=r;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return m.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.gq(m,3);C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.I(m,Vu(q.B,C,"transfer"),5);case 5:N=g.l$(C.key).entityId;gKN({videoId:N,JD:C,offlineModeType:(b=Y)==null?void 0:b.offlineModeType});g.St(m,4);break;case 3:return g.Zi(m),m.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return m.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},hQx=function(q,J,t){t=t===void 0?!1:t;
var x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n;return g.U(function(D){switch(D.D){case 1:return x=g.f(J.actionMetadata,TGB),k=g.l$(J.entityKey).entityId,H=g.u$(k,"downloadStatusEntity"),g.I(D,wu(q.B,{mode:"readonly",HK:!0},function(h){var X=Wp(h,H,"downloadStatusEntity");h=Wp(h,g.u$(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.y6.all([X,h])}),2);
case 2:return v=D.B,r=g.M(v),C=r.next().value,Y=r.next().value,N=C,b=Y,m="TRANSFER_STATE_TRANSFER_IN_QUEUE",((O=N)==null?void 0:O.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(m="TRANSFER_STATE_PAUSED_BY_USER"),p={key:J.entityKey,transferState:m,cotn:g.gS(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(F=x)==null?void 0:F.maximumDownloadQuality,preferredAudioTrack:(y=x)==null?void 0:y.preferredAudioTrack,transferRetryCount:0,isRefresh:t,hasLoggedFirstStarted:!1},g.I(D,wu(q.B,
{mode:"readwrite",HK:!0},function(h){var X=[];t&&X.push(Ly(h,g.u$(k,"offlineVideoStreams")));X.push(eC(h,p,"transfer"));return g.y6.all(X)}),3);
case 3:if(!t){D.bX(4);break}return g.I(D,noQ(k),4);case 4:Mx0({videoId:k,JD:p,offlineModeType:(n=b)==null?void 0:n.offlineModeType}),g.oC(D)}})},K8o=function(q,J,t,x){if(!q.action.entityKey)throw Error("entityKey is missing.");
var k=g.l$(q.action.entityKey);k={entityType:k.hg,entityId:k.entityId,offlineOrchestrationActionType:q.action.actionType,orchestrationAction:{orchestrationActionId:q.actionId}};J&&(k.offlineOrchestrationActionResult=J.status,k.isRetryable=t?!1:J.B,J.C&&(k.offlineOrchestrationFailureReason=jlN(J.C,k.isRetryable)));var H,v;if((H=q.action.actionMetadata)==null?0:(v=H.offlineLoggingData)==null?0:v.offlineModeType)k.offlineModeType=q.action.actionMetadata.offlineLoggingData.offlineModeType;x&&(k.additionalOrchestrationActions=
x.map(function(r){return{orchestrationActionId:r.actionId}}));
return k},jlN=function(q,J){return q!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||J?q==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&J?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":q:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},W8Q=function(q,J){var t={offlineOrchestrationContext:K8o(q)};
J=xzQ(J,t);kbN(txa(),J,q.rootActionId)},dkN=function(q,J,t,x){x=x===void 0?[]:x;
J={offlineOrchestrationContext:K8o(q,J,t,x)};J=xzQ(3,J);kbN(txa(),J,q.rootActionId)},fZQ=function(){this.actions=[]},eQa=function(q,J){J=g.M(J);
for(var t=J.next();!t.done;t=J.next())t=t.value,W8Q(t,1),q.actions.push(t);q.actions.sort(q.B)},L85=function(q,J){if(J)for(var t=0;t<q.actions.length;t++)if(J==="!*$_ALL_ENTITIES_!*$"&&q.actions[t].actionId!==J||J!=="!*$_ALL_ENTITIES_!*$"&&q.actions[t].rootActionId===J&&q.actions[t].actionId!==J)q.actions.splice(t,1),t--},lZN=function(q,J){q=g.M(q.actions);
for(var t=q.next();!t.done;t=q.next())if(t.value.actionId===J)return!0;return!1},TU=function(q,J,t,x,k){g.K.call(this);
var H=this;this.D=q;this.xZ=J;this.nC=t;this.L=x;this.lX=k;this.B=new fZQ;this.N=new g.Ls;this.C=new g.wG(function(){H.retry()});
this.W=NaN;this.V=!1;this.BW={yJX:function(){return H.B},
UO:function(){return H.N},
FJ4:function(){return H.C},
retry:function(){return H.retry()}};
g.W(this,this.C);this.X=this.D.observe(this.s4.bind(this))},VHx=function(q,J,t,x,k){var H;
return g.U(function(v){if(v.D==1)return H=new TU(q,J,t,x,k),g.I(v,u1Q(H),2);w7Q(H);return v.return(H)})},w7Q=function(q){var J=q.B.actions[0];
return q.Y?((J==null?void 0:J.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&q.Y[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(q.V=!0),Promise.resolve()):zQ0(q)},zQ0=function(q){var J,t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n;
return g.U(function(D){switch(D.D){case 1:if(q.Y)throw Error("Already processing an action");if(q.pC())return D.return();J=q.B.actions.shift();EKV(q.nC,!J);if(J===void 0)return D.return();J.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&J.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&L85(q.B,J.actionId);t="";J.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&J.rootActionId===J.actionId&&(t=J.actionId);x=[J];q.Y=x;if(k=q.xZ[J.entityType]){D.bX(2);break}q.Y=
void 0;return g.I(D,zQ0(q),3);case 3:return D.return();case 2:H=g.M(x);for(v=H.next();!v.done;v=H.next())r=v.value,W8Q(r,2);g.gq(D,4,5);return g.I(D,bCZ(k,x.map(function(h){return h.action})),7);
case 7:C=D.B,Y=g.M(x),N=Y.next();case 8:if(N.done){D.bX(10);break}b=N.value;m=C.get(b.action);return g.I(D,GE5(q,b,m),9);case 9:N=Y.next();D.bX(8);break;case 10:L85(q.B,t);case 5:g.BC(D);q.Y=void 0;g.$4(D,6);break;case 4:return O=g.Zi(D),xa("Orchestration error",O),g.gq(D,12),g.I(D,aZx(q,x),14);case 14:g.St(D,5);break;case 12:F=g.Zi(D);xa("Orchestration retry error",F);y=g.M(x);for(p=y.next();!p.done;p=y.next())n=p.value,n.retryScheduleIndex<3&&eQa(q.B,[n]);D.bX(5);break;case 6:return g.I(D,zQ0(q),
0)}})},GE5=function(q,J,t){var x,k,H,v,r,C,Y,N,b,m,O,F;
return g.U(function(y){switch(y.D){case 1:x=J.retryScheduleIndex+2===3;if(t.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){y.bX(2);break}if(t.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){y.bX(0);break}dkN(J,t,x);if(t.B&&J.retryScheduleIndex+1<3)return g.I(y,aZx(q,[J]),0);H=((k=t)==null?0:k.D)?t.D:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";v={entityKey:J.action.entityKey,failureReason:H};r=void 0;g.ww(q.lX)?r="mainVideoDownloadStateEntity":g.X2(q.lX)&&(r="musicTrackDownloadMetadataEntity");
if(!r||!t.downloadState){y.bX(7);break}C=g.l$(J.action.entityKey).entityId;return g.I(y,bg(C,r,q.D,t.downloadState),7);case 7:ig(q.L,v);if(t.downloadState==="DOWNLOAD_STATE_FAILED"&&q.lX.G("html5_auto_retry_failed_pde_actions")){y.bX(0);break}xa("Orchestration result is not retryable, deleting action");return g.I(y,PFB(q.D,Mt(J).key),0);case 2:Y=void 0;try{Y=(N=t.Y)==null?void 0:N.map(function(p){return q.createAction(p,J)})}catch(p){return dkN(J,t,x),b={entityKey:J.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},ig(q.L,b),xa("Orchestration subactions creation error",p),y.return()}dkN(J,t,x,Y);if(!Y){y.bX(12);break}m=Y.map(function(p){return Mt(p)});
O=0;case 13:if(!(O<Y.length)||q.V){y.bX(15);break}return g.I(y,wu(q.D,{mode:"readwrite",HK:!0},function(p){var n=[];n.push(DgV(p,m.slice(O,O+10),"offlineOrchestrationActionWrapperEntity"));return g.y6.all(n)}),16);
case 16:O+=10;y.bX(13);break;case 15:if(q.V)return q.V=!1,y.return();case 12:return F=Mt(J),g.I(y,PFB(q.D,F.key),17);case 17:W8Q(J,4),g.oC(y)}})},xuZ=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O;
return g.U(function(F){t=[];x=Infinity;k=4E3;H=g.M(J);for(v=H.next();!v.done;v=H.next())r=v.value,C=Number(r.enqueueTimeSec),Y=qNt(C),N=r.retryScheduleIndex,b=N!=null&&N>0,Y>0&&b?(x=Math.min(x,C),k=Math.min(Y,k)):t.push(r);isFinite(x)&&(!q.C.isActive()||x<q.W)&&(q.W=x,q.C.start(k));q.N.Qk()||(m=t.length,t=t.filter(function(y){var p;y=((p=y.actionProto)==null?void 0:p.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!JLo.includes(y)}),O=t.length<m,!q.C.isActive()&&O&&q.C.start(1));
t.length>0&&trV(q,t);return g.I(F,w7Q(q),0)})},iKP=function(q){var J,t,x,k,H,v,r;
return g.U(function(C){if(C.D==1)return g.I(C,kpZ(q),2);J=C.B;t=[];x=g.M(J);for(k=x.next();!k.done;k=x.next())H=k.value,v=g.l$(H.key),r=v.entityId,lZN(q.B,r)||t.push(H);return g.I(C,xuZ(q,t),0)})},qNt=function(q){q=q*1E3-Date.now();
return q>4E3?4E3:q},aZx=function(q,J){var t,x,k;
return g.U(function(H){t=g.M(J);for(x=t.next();!x.done;x=t.next()){k=x.value;var v=void 0,r=void 0,C=((r=k.action)==null?void 0:(v=r.actionMetadata)==null?void 0:v.retryScheduleIntervalsInSeconds)||[1,2,4];v=1;k.retryScheduleIndex<C.length&&(v=C[k.retryScheduleIndex]);k.B=v*1E3+Date.now();k.retryScheduleIndex++}return g.I(H,HKN(q,J),0)})},u1Q=function(q){var J;
return g.U(function(t){if(t.D==1)return g.I(t,GL(q.D,"offlineOrchestrationActionWrapperEntity"),2);J=t.B;return g.I(t,xuZ(q,J),0)})},trV=function(q,J){J.length!==0&&J.forEach(function(t){t=ch(t);
t.retryScheduleIndex<3&&eQa(q.B,[t])})},kpZ=function(q,J){var t;
return g.U(function(x){if(x.D==1)return g.I(x,GL(q.D,"offlineOrchestrationActionWrapperEntity",J),2);t=x.B;return x.return(t.filter(fTN))})},HKN=function(q,J){if(J.length===0)return Promise.resolve([]);
J=J.map(function(t){return Mt(t)});
return XR0(q.D,J)},viQ=function(q){this.Pj=q;
this.B=void 0},RfV=function(q,J){var t,x,k,H;
return g.U(function(v){t=J.videoId;x=!0;if(J.captionTracks.length)k=yVN(J),q.B=new g.FC(q.Pj,J,k);else if(J.sQ)H=g.ILP(J),q.B=new g.cZ(q.Pj,J.sQ,t,H,J.Wc,J.eventId),x=J.Wc;else return v.return();return v.return(new Promise(function(r){var C;(C=q.B)==null||C.Dm({q4:function(){return g.U(function(Y){if(Y.D==1)return g.I(Y,q.q4(t,x),2);r();g.oC(Y)})},
rR:function(){}})}))})},rLo=function(q){var J;
return g.U(function(t){if(t.D==1)return g.I(t,wRD(q),2);J=t.B;return t.return(!!J&&J.length>0)})},jb=function(q){g.K.call(this);
this.B=q;this.D=this.B.observe(this.C.bind(this))},CIt=function(q,J){var t,x,k,H,v,r,C;
return g.U(function(Y){switch(Y.D){case 1:if(J.length===0)return Y.return([]);t=J.map(function(N){return g.u$(N,"transfer")});
return g.I(Y,GL(q.B,"transfer",t),2);case 2:x=Y.B;k=x.filter(fTN).map(function(N){return g.l$(N.key).entityId});
H=J.filter(function(N){return k.indexOf(N)===-1});
if(H.length===0)return Y.return([]);v=g.M(H);r=v.next();case 3:if(r.done){Y.bX(5);break}C=r.value;return g.I(Y,noQ(C),4);case 4:r=v.next();Y.bX(3);break;case 5:return Y.return(H)}})},bKt=function(q,J,t,x,k,H){var v,r,C;
return g.U(function(Y){v="STREAM_TYPE_UNKNOWN";t.video&&t.audio?(v="STREAM_TYPE_AUDIO_AND_VIDEO",xa("unexpected stream type")):t.video&&!t.audio?v="STREAM_TYPE_VIDEO":!t.video&&t.audio&&(v="STREAM_TYPE_AUDIO");r=g.u$(J,"offlineVideoStreams");C={numBytesDownloaded:k.toFixed(),numTotalBytes:H.toFixed(),streamType:v,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(x),itag:v==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(t.itag):void 0};return g.I(Y,wu(q,{mode:"readwrite",HK:!0},
function(N){var b=Wp(N,r,"offlineVideoStreams"),m=Wp(N,g.u$(J,"transfer"),"transfer");return g.y6.all([b,m]).then(function(O){O=g.M(O);var F=O.next().value;O=O.next().value;if(!O)return Ly(N,r).then(function(){});
var y=YNt(F);F=NfN(F,x,C,r);var p=eC(N,F,"offlineVideoStreams");YNt(F)>y&&(O.lastProgressTimeMs=Date.now().toString());y=[p];O.offlineVideoStreams||(O.offlineVideoStreams=[]);O.offlineVideoStreams.indexOf(r)===-1&&(O.offlineVideoStreams.push(r),y.push(eC(N,O,"transfer")));return g.y6.all(y)})}),0)})},muV=function(q,J){var t,x,k,H,v;
return g.U(function(r){if(r.D==1)return t=g.u$(J,"offlineVideoStreams"),g.I(r,zL(q,t,"offlineVideoStreams"),2);x=r.B;if(!x||!x.streamsProgress)return r.return();k=g.M(x.streamsProgress);for(H=k.next();!H.done;H=k.next())v=H.value,v.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",v.numTotalBytes!==v.numBytesDownloaded&&(v.numBytesDownloaded=v.numTotalBytes);return g.I(r,Vu(q,x,"offlineVideoStreams"),0)})},NfN=function(q,J,t,x){if(q&&q.streamsProgress){x=q;
a:{J=J.itag+";"+J.xtags;for(var k=q.streamsProgress,H=0;H<k.length;H++){var v=JSON.parse(k[H].formatStreamBytes);if(v.itag+";"+v.xtags===J){k[H]=t;t=k;break a}}k.push(t);t=k}x.streamsProgress=t}else q={key:x,streamsProgress:[t]};return q},YNt=function(q){if(q==null?0:q.streamsProgress){var J=0;
q=q.streamsProgress;for(var t=0;t<q.length;t++){var x=q[t];isNaN(Number(x.numBytesDownloaded))?xa("stream progress bytes number invalid"):J+=Number(x.numBytesDownloaded)}return J}return 0},OKN=function(q,J,t,x){g.K.call(this);
var k=this;this.D=q;this.api=J;this.NW=t;this.s4=x;this.N=new g.Ls;this.Y=new g.wG(function(){k.B&&k.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&k.N.Qk()&&((k.B.transferRetryCount||0)<3?U4(k.L,k.V,!1,!1):Ph(k.L,k.V.videoDetails.videoId),k.Vu("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.nC=this.cj=0;this.X=this.W=!1;this.LC=g.rW(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.qW=new g.hp(this);this.BW={V1r:function(){return k.Y},
udj:function(){return k.s4},
UO:function(){return k.N}};
this.xZ=this.D.observe(this.Ac.bind(this));this.L=new Dkt(J,this);this.Jl=new viQ(J);this.Qw=new jb(this.D);this.zM=this.N.listen("publicytnetworkstatus-online",this.k9.bind(this));this.F_=this.N.listen("publicytnetworkstatus-offline",this.v1X.bind(this));this.X=this.api.U().G("html5_less_transfer_processing_logs");g.W(this,this.qW);this.qW.S(J,"offlinetransferpause",this.JKw);g.ww(this.api.U())?this.C="mainVideoDownloadStateEntity":g.X2(this.api.U())&&(this.C="musicTrackDownloadMetadataEntity")},
FMo=function(q){return g.U(function(J){if(J.D==1)J=g.I(J,lTa(),2);
else{var t=q.Qw;var x=g.Ql();x=Object.keys(x);t=CIt(t,x);J=g.I(J,t,0)}return J})},Wh=function(q,J){J=J===void 0?!1:J;
var t;return g.U(function(x){if(x.D==1){if(q.B)throw Error("Already downloading a video");q.nC=0;q.W=!1;return g.I(x,Eit(q),2)}return x.D!=4?(t=x.B,cJt(q.NW,!t),t&&q.N.Qk()?J?g.I(x,new Promise(function(k){g.mp(k,1E3)}),4):x.bX(4):(!t&&q.B&&K0(q),x.bX(0))):g.I(x,cLZ(q,t),0)})},MrZ=function(q){return g.U(function(J){if(J.D==1)return q.V?g.I(J,Ph(q.L,q.V.videoDetails.videoId),3):J.bX(0);
K0(q);g.oC(J)})},oix=function(q,J){var t,x,k;
return g.U(function(H){switch(H.D){case 1:return g.gq(H,2),(t=!!J.captionTracks.length||!!J.sQ)?g.I(H,rLo(J.videoId),4):H.return();case 4:return(x=H.B)?H.return():g.I(H,RfV(q.Jl,J),5);case 5:g.St(H,0);break;case 2:k=g.Zi(H),xa("Caption downloading error",k,J.cotn),g.oC(H)}})},cLZ=function(q,J){var t,x,k,H,v,r;
return g.U(function(C){switch(C.D){case 1:if(q.W)return C.return();q.W=!0;q.B=J;t=g.l$(q.B.key);x=t.entityId;k=void 0;if(q.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.I(C,dT(q,x),7);if(q.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||q.B.transferRetryCount||q.B.hasLoggedFirstStarted){C.bX(3);break}return g.I(C,dT(q,x),5);case 5:return k=C.B,q.B.hasLoggedFirstStarted=!0,g.I(C,giN(q),6);case 6:oKZ({videoId:x,JD:q.B,offlineModeType:k},void 0,void 0,!0);C.bX(3);break;case 7:k=C.B,
RZ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:x,JD:q.B,offlineModeType:k});case 3:return g.I(C,yLu(q),8);case 8:return H=null,g.gq(C,9),g.I(C,p1Z(q,J),11);case 11:H=C.B;q.V=H;g.St(C,10);break;case 9:return v=g.Zi(C),xa("error getting player response",v,J.cotn),g.I(C,q.Vu("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return C.return();case 10:return r=nKZ(q.api.U(),J.cotn,H),g.I(C,oix(q,r),13);case 13:return g.I(C,ZCo(r.videoId),
14);case 14:r.O3=C.B,$kQ(q.L,r,J.maximumDownloadQuality),q.Y.start(108E5),g.oC(C)}})},Eit=function(q){var J,t;
return g.U(function(x){if(x.D==1)return g.I(x,GL(q.D,"transfer"),2);J=x.B;t=J.filter(s4N).sort(SNx);return t.length===0?x.return():x.return(t[0])})},yLu=function(q){var J,t,x;
return g.U(function(k){if(k.D==1){if(!q.B)return f0(q,"onTransferStart"),k.return();q.Y.start(108E5);return g.I(k,eb(q,"TRANSFER_STATE_TRANSFERRING"),2)}J=q.B;return(x=((t=J)==null?0:t.key)?g.l$(J.key).entityId:"")&&q.C?g.I(k,bg(x,q.C,q.D,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):k.bX(0)})},BGD=function(q){var J,t,x,k;
g.U(function(H){switch(H.D){case 1:if(!q.B){f0(q,"onTransferPausedByUser");H.bX(2);break}J=q.B;q.Y.stop();return g.I(H,eb(q,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:x=((t=J)==null?0:t.key)?g.l$(J.key).entityId:"";if(!x||!q.C){H.bX(4);break}return g.I(H,bg(x,q.C,q.D,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.I(H,dT(q,x),6);case 6:k=H.B,yJ0({videoId:x,JD:J,offlineModeType:k});case 2:K0(q),Wh(q),g.oC(H)}})},Aqu=function(q){var J,t,x;
g.U(function(k){if(k.D==1){if(!q.B)return f0(q,"onTransferPausedByNetwork"),k.return();q.Y.stop();return g.I(k,eb(q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(k.D!=3)return J=q.B,(x=((t=J)==null?0:t.key)?g.l$(J.key).entityId:"")&&q.C?g.I(k,bg(x,q.C,q.D,"DOWNLOAD_STATE_PAUSED"),3):k.bX(3);K0(q);g.oC(k)})},DuB=function(q){var J,t,x,k,H;
g.U(function(v){switch(v.D){case 1:if(!q.B)return f0(q,"onTransferComplete"),v.return();J=q.B;q.Y.stop();if(!J||!q.V){v.bX(2);break}t=nKZ(q.api.U(),J.cotn,q.V);return g.I(v,oix(q,t),2);case 2:return g.I(v,eb(q,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:k=((x=J)==null?0:x.key)?g.l$(J.key).entityId:"";if(!k||!q.C){v.bX(5);break}return g.I(v,bg(k,q.C,q.D,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.I(v,muV(q.D,k),7);case 7:return g.I(v,dT(q,k),8);case 8:H=v.B,RZ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:k,JD:J,offlineModeType:H}),K0(q),Wh(q),g.oC(v)}})},niN=function(q,J,t){var x,k;
g.U(function(H){switch(H.D){case 1:if(!q.B)return f0(q,"onTransferProgress: "+J),H.return();if(q.B.transferState==="TRANSFER_STATE_TRANSFERRING"){H.bX(2);break}return g.I(H,yLu(q),2);case 2:x=Date.now();if(!(x-q.cj>1E3)){H.bX(4);break}q.cj=x;return g.I(H,bKt(q.D,t.videoId,t.D,t.XZ,t.bytesDownloaded,t.B),5);case 5:if(q.X&&!(q.X&&x-q.nC>q.LC)){H.bX(4);break}q.nC=x;return g.I(H,dT(q,J),7);case 7:k=H.B,oKZ({videoId:J,JD:q.B,offlineModeType:k},t.bytesDownloaded,t.B);case 4:q.Y.start(108E5),g.oC(H)}})},
ZKt=function(q){var J=(q.B.transferRetryCount||0)<3;
J&&(q=q.B,q.transferRetryCount=(q.transferRetryCount||0)+1);return J},Q4Q=function(q,J){J=J===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":J;
var t,x,k,H;return g.U(function(v){if(v.D==1)return q.B||f0(q,"setTransferToFailed: "+J),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J==="TRANSFER_FAILURE_REASON_NETWORK"?t="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":J==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.I(v,eb(q,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",J),2);if(v.D!=3)return ig(q.s4,{entityKey:(x=q.B)==null?void 0:x.key,failureReason:t}),
k=q.B?g.l$(q.B.key).entityId:"",g.I(v,dT(q,k),3);H=v.B;var r={videoId:k,JD:q.B,offlineModeType:H},C=J,Y={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};C&&(Y.transferFailureReason=C,Y.failureReason=pI5(C));RZ(Y,r);g.oC(v)})},eb=function(q,J,t,x){var k;
return g.U(function(H){if(H.D==1){if(!q.B)return f0(q,"saveTransferState: "+J),H.return();q.B.transferState=J;q.B.failureReason=x;g.gq(H,2);return g.I(H,giN(q,function(v){return t?du(v,"offlineVideoStreams",q.B.offlineVideoStreams).then(function(r){for(var C=g.M(r),Y=C.next();!Y.done;Y=C.next())if((Y=Y.value)&&Y.streamsProgress){Y=g.M(Y.streamsProgress);for(var N=Y.next();!N.done;N=Y.next())N.value.streamState=t}return DgV(v,r.filter(function(b){return!!b}),"offlineVideoStreams")}):g.y6.resolve(void 0)}),
4)}if(H.D!=2)return g.St(H,0);
k=g.Zi(H);return k instanceof g.OQ&&k.type==="QUOTA_EXCEEDED"?g.I(H,q.Vu("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):H.bX(0)})},giN=function(q,J){var t;
return g.U(function(x){if(!q.B)return x.return();t=q.B;return g.I(x,wu(q.D,{mode:"readwrite",HK:!0},function(k){var H=[eC(k,t,"transfer")];J&&H.push(J(k));return g.y6.all(H)}),0)})},K0=function(q){q.B=void 0;
q.V=void 0;q.Y.stop()},p1Z=function(q,J){var t,x,k,H,v;
return g.U(function(r){if(r.D==1)return t=g.l$(J.key),x=t.entityId,k=g.u$(x,"playbackData"),g.I(r,zL(q.D,k,"playbackData"),2);H=r.B;if((v=H)==null?0:v.playerResponseJson)return r.return(JSON.parse(H.playerResponseJson));throw Error("No PlayerResponse found");})},f0=function(q,J){q.api.iX("woffle",{mcte:J});
xa("missing current transfer entity.")},dT=function(q,J){var t,x,k;
return g.U(function(H){if(H.D==1)return g.I(H,zL(q.D,g.u$(J,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);t=H.B;return H.return((k=(x=t)==null?void 0:x.offlineModeType)!=null?k:void 0)})},s4N=function(q){return Bf5[q.transferState]!==void 0},SNx=function(q,J){var t=Bf5[q.transferState],x=Bf5[J.transferState];
return t!==x?t-x:Number(q.enqueuedTimestampMs)-Number(J.enqueuedTimestampMs)},L0=function(q,J){var t=this;
this.lX=q;this.api=J;this.N=new g.Ls;this.V=new g.YK;this.BW={gD:function(){return t.C.BW.gD()},
UO:function(){return t.N},
xzm:function(){return t.C},
qI:function(){return t.qI()},
SV:function(){return t.SV()},
UM:function(){return t.UM()},
CX:function(){return t.CX()},
nX:function(){return t.nX()},
aN:function(x){return t.aN(x)}};
this.C=new mzQ(function(){return ALV(t)},function(){t.UM()},this.api.dc(),this.api.G.bind(this.api));
this.B=new ka(this.api);OnN(this.C)},ALV=function(q){return g.U(function(J){q.api.Sr("onOrchestrationBecameLeader");
return g.I(J,q.SV(),0)})},IVo=function(q){var J,t;
return g.U(function(x){if(x.D==1)return g.I(x,at(),2);if(x.D!=3){J=x.B;if(!J)return xa("PES is undefined"),x.return();q.D=new OKN(J,q.api,q.C,q.B);t=q.o3(J);return g.I(x,VHx(J,t,q.C,q.B,q.lX),3)}q.L=x.B;return g.I(x,$uB(q),0)})},$uB=function(q){var J;
return g.U(function(t){switch(t.D){case 1:if(!q.D)return xa("transferManager is undefined"),t.return();if(q.D.B){t.bX(2);break}return g.I(t,Wh(q.D),2);case 2:if(!q.lX.G("woffle_enable_main_downloads_library")){t.bX(4);break}return g.I(t,q.S0(),4);case 4:if(!q.lX.G("html5_offline_playback_position_sync")){t.bX(6);break}return g.I(t,q.MN(),7);case 7:return g.I(t,q.aN(864E5),6);case 6:return g.I(t,q.refreshAllStaleEntities(43200,!0),9);case 9:return g.I(t,q.Xi(),10);case 10:if(!q.lX.G("html5_retry_downloads_for_expiration")){t.bX(11);
break}return g.I(t,q.nX(),11);case 11:return q.W=g.OK(function(){q.refreshAllStaleEntities(43200,!0);q.Xi()},9E5),g.z2(g.a3(),function(){return q.CX()}),g.I(t,at(),13);
case 13:return J=t.B,g.I(t,bn5(J),14);case 14:F3Q(q.C),g.oC(t)}})},hfV=function(){var q,J,t,x,k,H;
return g.U(function(v){switch(v.D){case 1:return g.I(v,at(),2);case 2:q=v.B;if(!q)return v.return([]);J=Date.now()/1E3;return g.I(v,GL(q,"offlineVideoPolicy"),3);case 3:t=v.B,x=g.M(t),k=x.next();case 4:if(k.done){v.bX(6);break}H=k.value;if(!(H.expirationTimestamp&&Number(H.expirationTimestamp)<J)){v.bX(5);break}H.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";H.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.I(v,Vu(q,H,"offlineVideoPolicy"),5);
case 5:k=x.next();v.bX(4);break;case 6:return v.return(t.map(function(r){return r.key}))}})},lg=function(q,J,t,x,k){var H,v,r;
return g.U(function(C){if(C.D==1)return g.I(C,at(),2);H=C.B;if(!H)return C.return([]);v=J.map(function(Y){var N=g.u$(Y,t);N={actionType:x,entityKey:N,actionMetadata:Object.assign({},ZnZ(),k)};x!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(N.actionMetadata.priority=0);Y=new E4(t,Y,N);return Mt(Y)});
r=XR0(H,v);OnN(q.C);return C.return(r)})},X1Z=function(q,J,t,x){var k,H,v,r,C,Y,N,b;
return g.U(function(m){switch(m.D){case 1:k=[],H=g.M(J),v=H.next();case 2:if(v.done){m.bX(4);break}r=v.value;if(r.upToDate||t&&!r.shouldAutoSyncMetadata||!r.playlistId){m.bX(3);break}C={};switch(x){case "mainPlaylistEntity":Y={nextAutoRefreshIntervalSeconds:r.checkInSeconds,autoSync:t};C={mainPlaylistEntityActionMetadata:Y};break;case "musicPlaylist":N={autoSync:t},C={musicPlaylistEntityActionMetadata:N}}return g.I(m,lg(q,[r.playlistId],x,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C),6);case 6:(b=
m.B)&&k.push.apply(k,g.Z(b));case 3:v=H.next();m.bX(2);break;case 4:return m.return(k)}})},PIV=function(q,J){var t;
return g.U(function(x){return J.length?(t=ZnZ(),g.Tk(t,hz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q.api.iX("qrd",{v:J.length}),x.return(lg(q,J,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t))):x.return([])})},UuB=function(q,J,t){this.B=q;
this.lX=J;this.C=t},KMo=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D;
return g.U(function(h){switch(h.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,H=[],g.gq(h,2),g.I(h,TfV(q,k),4);case 4:H=h.B;if(!(q.lX.G("woffle_enable_main_downloads_library")&&((v=H)==null?0:v.length))){h.bX(5);break}return g.I(h,W3t(q.B,[J.entityKey]),5);case 5:g.St(h,3);break;case 2:return r=g.Zi(h),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.OQ&&r.type==="QUOTA_EXCEEDED"?(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):xa("Playlist add error"),h.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,C,Y));case 3:N=[];if(!q.lX.G("html5_offline_prevent_redownload_downloaded_video")){h.bX(7);break}return g.I(h,Dzu(q.B,"mainVideoEntity",H),8);case 8:H=h.B;case 7:if((b=H)==null?0:b.length)for(m=g.M(H),O=m.next();!O.done;O=m.next())if(F=O.value,y=F.offlineVideoData,p=void 0,(p=y)==null?0:p.videoId)n=void 0,D=Number(((n=J.actionMetadata)==null?void 0:n.priority)||
0)+1,N.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y.videoId,"mainVideoEntity",D,ug,j4t(J,y,k)));return h.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,N))}})},dux=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL,Qa,FB,KX,XB,Bt,Q,B,A,P,e,sV,th,cC,k4,Ah,zW,pN,pT,$3,lA,LT,uA,ge,NH,Bc,Ei,A5,f8,eF,sA,kv,we,H4,sU,fk;
return g.U(function(Ey){switch(Ey.D){case 1:return t=rT(J),x=J.entityKey,k=g.l$(x).entityId,H=[],v=!1,k==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.I(Ey,GL(q.B,"mainPlaylistEntity"),5)):g.I(Ey,zL(q.B,x,"mainPlaylistEntity"),4);case 4:(r=Ey.B)&&H.push(r);Ey.bX(3);break;case 5:H=Ey.B;case 3:if((C=H)==null||!C.length)return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));Y=g.f(J.actionMetadata,WMt);b=(N=Y)==null?void 0:N.nextAutoRefreshIntervalSeconds;O=(m=Y)==null?void 0:m.autoSync;F=[];p=y=
!0;n=!1;if(!v&&O===!1){Ey.bX(6);break}g.gq(Ey,7);return g.I(Ey,tHB(0,!!O,!0,H),9);case 9:F=Ey.B;g.St(Ey,8);break;case 7:D=g.Zi(Ey);if(!(D instanceof Error&&D.message==="No data")){D instanceof Error&&D.message==="Empty response body"&&xa(D.message);Ey.bX(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.I(Ey,XIt(q.B,J,q.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.I(Ey,IFo(k,q.B,J,q.C),8);case 8:if(!F.length||!v&&F[0].playlistId!==k)return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));case 6:if(v){h=[];X=g.M(F);for(d=X.next();!d.done;d=X.next())z=d.value,z.upToDate||O&&!z.shouldAutoSyncMetadata||!z.playlistId||(u={nextAutoRefreshIntervalSeconds:z.checkInSeconds,autoSync:O},h.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",z.playlistId,"mainPlaylistEntity",0,ug,{mainPlaylistEntityActionMetadata:u})));return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,h))}F.length&&(x4=F[0],n=!!x4.upToDate,O&&(y=(iB=x4.shouldAutoSyncMetadata)!=null?iB:!0,p=(qP=x4.shouldAutoSyncVideos)!=
null?qP:!0,x4.checkInSeconds&&(b=x4.checkInSeconds)));if(n||!y)return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));rq=[];G=H[0];if(!G.downloadState){yn=void 0;Ey.bX(15);break}return g.I(Ey,zL(q.B,G.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:yn=Ey.B;case 15:return nX=yn,SP=((fX=nX)==null?0:fX.addedTimestampMillis)?String(nX.addedTimestampMillis):void 0,g.gq(Ey,17),g.I(Ey,TfV(q,k,SP,b),19);case 19:rq=Ey.B;g.St(Ey,18);break;case 17:rQ=g.Zi(Ey);if(!(rQ instanceof
Error&&rQ.message==="No data for playlist")){if(rQ instanceof Error&&rQ.message==="Empty response body for playlist")xa(rQ.message);else return Qn="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Di="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",rQ instanceof g.OQ&&rQ.type==="QUOTA_EXCEEDED"&&(Qn="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Di="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Qn,Di));
Ey.bX(18);break}return g.I(Ey,IFo(k,q.B,J,q.C),18);case 18:if(!p)return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));ix=[];S=new Map;if((RC=rq)==null?0:RC.length)for(lx=g.M(rq),yL=lx.next();!yL.done;yL=lx.next())Qa=yL.value,FB=Qa.offlineVideoData,KX=void 0,((KX=FB)==null?0:KX.videoId)&&S.set(FB.videoId,FB);XB=new Map;Bt=[];if((Q=G)==null?0:(B=Q.videos)==null?0:B.length)for(A=g.M(G.videos),P=A.next();!P.done;P=A.next())if(e=P.value,sV=JSON.parse(g.l$(e).entityId),th=sV.videoId)S.has(th)?
(XB.set(th,S.get(th)),S.delete(th)):Bt.push(th);k4=Number(((cC=J.actionMetadata)==null?void 0:cC.priority)||0)+1;Ah=g.M(S.entries());for(zW=Ah.next();!zW.done;zW=Ah.next())pN=zW.value,pT=g.M(pN),$3=pT.next().value,lA=pT.next().value,LT=$3,uA=lA,ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",LT,"mainVideoEntity",k4,ug,j4t(J,uA,k)));ge=g.M(XB.entries());for(NH=ge.next();!NH.done;NH=ge.next())Bc=NH.value,Ei=g.M(Bc),A5=Ei.next().value,f8=Ei.next().value,eF=A5,sA=f8,ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
eF,"mainVideoEntity",k4,ug,j4t(J,sA,k)));kv=g.M(Bt);for(we=kv.next();!we.done;we=kv.next())H4=we.value,sU={playlistId:k},fk={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:sU},ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",H4,"mainVideoEntity",0,ug,fk));return Ey.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,ix))}})},fVD=function(q,J){var t,x,k,H;
return g.U(function(v){switch(v.D){case 1:return t=rT(J),g.gq(v,2),x=g.l$(J.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.I(v,XIt(q.B,J,q.C,(k=J.actionMetadata)==null?void 0:(H=k.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.I(v,IFo(x,q.B,J,q.C),6);case 6:if(!q.lX.G("woffle_enable_main_downloads_library")){v.bX(5);break}return g.I(v,dzN(q.B,J.entityKey),5);case 5:g.St(v,3);break;case 2:return g.Zi(v),v.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},TfV=function(q,J,t,x){var k,H,v,r,C,Y,N;
return g.U(function(b){switch(b.D){case 1:return g.I(b,qUx([J]),2);case 2:return k=b.B,g.I(b,efN(q,k[0],t,x),3);case 3:return H=b.B,v=H.mainPlaylistEntity,r=H.ZnW,Y=AJN(v,(C=r)==null?void 0:C.avatar),g.gq(b,4),g.I(b,gT(Y),6);case 6:g.St(b,5);break;case 4:N=g.Zi(b),N instanceof Error&&N.message==="Failed to fetch"&&xa(N.message);case 5:return b.return(k[0].videos)}})},efN=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X;
return g.U(function(d){switch(d.D){case 1:k=Date.now().toString();t||(t=k);H=J.videos;v=J.playlistId;r=[];C=[];if(H)for(Y=g.M(H),N=Y.next();!N.done;N=Y.next()){b=N.value;m=b.offlineVideoData;if(!m||!m.videoId)throw xa("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");O=m.videoId;F={videoId:O,playlistId:v};y={id:g.u$(JSON.stringify(F),"mainPlaylistVideoEntity"),video:g.u$(O,"mainVideoEntity")};r.push(y);C.push(y.id)}n={key:g.u$(v,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:t,lastSyncedTimestampMillis:k};D={key:g.u$(v,"mainPlaylistEntity"),playlistId:v,videos:C,title:J.title,thumbnailStyleData:LMo(J),visibility:lVo(J),downloadState:n.key};J.channel&&(h=J.channel.offlineChannelData,p=unP(g.u$(v,"ytMainChannelEntity"),h),D.channelOwner=p.id);((X=D)==null?0:X.entityMetadata)?(D.entityMetadata.offlineLastModifiedTimestampSeconds=J.lastModifiedTimestamp,x&&(D.entityMetadata.nextAutoRefreshIntervalSeconds=String(x))):D&&(D.entityMetadata={nextAutoRefreshIntervalSeconds:x?
String(x):void 0,offlineLastModifiedTimestampSeconds:J.lastModifiedTimestamp});g.gq(d,2);return g.I(d,wu(q.B,{mode:"readwrite",HK:!0},function(z){var u=eC(z,D,"mainPlaylistEntity"),x4=eC(z,n,"mainPlaylistDownloadStateEntity");u=[u,x4];x4=g.M(r);for(var iB=x4.next();!iB.done;iB=x4.next())u.push(eC(z,iB.value,"mainPlaylistVideoEntity"));p&&u.push(eC(z,p,"ytMainChannelEntity"));return g.y6.all(u)}),4);
case 4:g.St(d,3);break;case 2:throw g.Zi(d),xa("PES failure for playlist"),Error("PES failure for playlist");case 3:return d.return({mainPlaylistEntity:D,ZnW:p,RMM:r})}})},unP=function(q,J){return{id:q,
channelId:J.channelId,title:J.title,avatar:J.thumbnail}},LMo=function(q){var J=[],t=q.videos;
t&&t.length>0&&J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:t[0].offlineVideoData.thumbnail}}});if((q=q.additionalMetadadatas)&&q.length>0)for(q=g.M(q),t=q.next();!t.done;t=q.next()){var x=t.value.offlineBundleItemPlaylistData,k=void 0;t=(k=x)==null?void 0:k.style;k=void 0;x={collageThumbnail:{coverThumbnail:(k=x)==null?void 0:k.coverThumbnail}};switch(t){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:x});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:x});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:x})}}return J},lVo=function(q){switch(q.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},j4t=function(q,J,t){J={offlineVideoData:J,
playlistId:t};if(q=g.f(q.actionMetadata,WMt))J.maximumDownloadQuality=q.maximumDownloadQuality;return{mainVideoEntityActionMetadata:J}},w10=function(q,J,t){this.B=q;
this.lX=J;this.C=t},GpQ=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F;
return g.U(function(y){switch(y.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,H=g.f(J.actionMetadata,wT),r=!((v=H)==null?0:v.playlistId),g.gq(y,2),g.I(y,Vr0(q,k,void 0,(C=H)==null?void 0:C.offlineVideoData,r),4);case 4:g.St(y,3);break;case 2:return Y=g.Zi(y),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.OQ&&Y.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,N,b));case 3:m=1;m=Number(((O=J.actionMetadata)==null?void 0:O.priority)||0)+1;var p=(p=g.f(J.actionMetadata,wT))?{playbackDataActionMetadata:{maximumDownloadQuality:p.maximumDownloadQuality}}:void 0;F=$a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",m,zfN,p);return y.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,[F]))}})},aVD=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D;
return g.U(function(h){switch(h.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,g.I(h,zL(q.B,J.entityKey,"mainVideoEntity"),2);case 2:H=h.B;if(!H){v=void 0;h.bX(3);break}return g.I(h,zL(q.B,H.downloadState,"mainVideoDownloadStateEntity"),4);case 4:v=h.B;case 3:r=v;if(!H||!r)return h.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.gq(h,5);return g.I(h,Vr0(q,k,r.addedTimestampMillis,(Y=g.f(J.actionMetadata,wT))==null?void 0:Y.offlineVideoData),7);case 7:N=1;N=Number(((b=
J.actionMetadata)==null?void 0:b.priority)||0)+1;C=$a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",N,zfN);g.St(h,6);break;case 5:m=g.Zi(h);if(!(m instanceof Error&&m.message==="No data")){if(m instanceof Error&&m.message==="Empty response body")xa(m.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",m instanceof g.OQ&&m.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,O,F));h.bX(6);break}return g.I(h,s4(q.B,k),9);case 9:y=h.B;p=g.f(J.actionMetadata,wT);if(D=(n=p)==null?void 0:n.playlistId)y.playlistId=D;y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.I(h,y3(k,q.B,J,q.C,y),6);case 6:return h.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,C?[C]:void 0))}})},qkQ=function(q,J){var t,x,k,H,v,r,C,Y,N,b;
return g.U(function(m){switch(m.D){case 1:return t=rT(J),g.gq(m,2),x=g.l$(J.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.I(m,XIt(q.B,J,q.C,(N=J.actionMetadata)==null?void 0:(b=N.offlineLoggingData)==null?void 0:b.offlineDeleteReason),5):g.I(m,s4(q.B,x),6);case 6:k=m.B;H=g.f(J.actionMetadata,wT);if(r=(v=H)==null?void 0:v.playlistId)k.playlistId=r;k.offlineDeleteReason=(C=J.actionMetadata)==null?void 0:(Y=C.offlineLoggingData)==null?void 0:Y.offlineDeleteReason;return g.I(m,y3(x,q.B,J,q.C,k),7);
case 7:if(!q.lX.G("woffle_enable_main_downloads_library")){m.bX(5);break}return g.I(m,dzN(q.B,J.entityKey),5);case 5:g.St(m,3);break;case 2:return g.Zi(m),m.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},Vr0=function(q,J,t,x,k){var H,v,r,C,Y,N;
return g.U(function(b){switch(b.D){case 1:if(H=x){b.bX(2);break}return g.I(b,aFQ([J]),3);case 3:v=b.B,H=v[0];case 2:return g.I(b,JIQ(q,H,t,k),4);case 4:r=b.B;C=r.mainVideoEntity;Y=r.channelEntity;g.gq(b,5);var m=Fx(C.thumbnail),O=Fx(Y.avatar);return g.I(b,gT(m.concat(O)),7);case 7:g.St(b,0);break;case 5:N=g.Zi(b),N instanceof Error&&N.message==="Failed to fetch"&&xa(N.message),g.oC(b)}})},JIQ=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m,O,F,y,p;
return g.U(function(n){switch(n.D){case 1:t||(t=Date.now().toString());H=(k=J.channel)==null?void 0:k.offlineChannelData;v={id:g.u$(J.videoId,"ytMainChannelEntity"),channelId:H.channelId,title:H.title,avatar:H.thumbnail};r={key:g.u$(J.videoId,"mainVideoDownloadStateEntity"),playbackData:g.u$(J.videoId,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.u$(J.videoId,"videoDownloadContextEntity")};C={key:g.u$(J.videoId,"videoPlaybackPositionEntity"),videoId:J.videoId,lastPlaybackPositionSeconds:"0"};
q.lX.G("html5_offline_playback_position_sync")&&(Y={playbackPosition:C.key});N=g.u$(J.videoId,"mainVideoEntity");b={key:N,videoId:J.videoId,title:J.title,thumbnail:J.thumbnail,localizedStrings:{viewCount:J.shortViewCountText},userState:Y,lengthSeconds:J.lengthSeconds?Number(J.lengthSeconds):void 0,publishedTimestampMillis:J.publishedTimestamp?(Number(J.publishedTimestamp)*1E3).toString():void 0,formattedDescription:J.description,owner:v.id,downloadState:r.key};if(!q.lX.G("woffle_enable_main_downloads_library")||
!x){n.bX(2);break}return g.I(n,K3P(q.B,[N]),3);case 3:if(F=n.B)m=F.mainDownloadsLibraryEntity,O=F.mainDownloadsListEntity;case 2:return p=Seu,y={key:g.u$(J.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Tk(r,p,y),g.I(n,wu(q.B,{mode:"readwrite",HK:!0},function(D){var h=eC(D,v,"ytMainChannelEntity"),X=eC(D,r,"mainVideoDownloadStateEntity"),d=eC(D,b,"mainVideoEntity");h=[h,X,d];q.lX.G("html5_offline_playback_position_sync")&&(X=eC(D,C,"videoPlaybackPositionEntity"),
h.push(X));m&&(X=eC(D,m,"mainDownloadsLibraryEntity"),h.push(X));O&&(X=eC(D,O,"mainDownloadsListEntity"),h.push(X));y&&(D=eC(D,y,"downloadStatusEntity"),h.push(D));return g.y6.all(h)}),4);
case 4:return n.return({mainVideoEntity:b,channelEntity:v})}})},tqN=function(q,J,t){this.B=q;
this.lX=J;this.C=t},kDZ=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G;
return g.U(function(yn){switch(yn.D){case 1:return t=rT(J),x=[],g.I(yn,TL.getInstance(),2);case 2:k=yn.B;if(!k){yn.bX(3);break}return g.I(yn,k.get("sdois"),4);case 4:return H=yn.B,g.I(yn,(r=k)==null?void 0:r.get("lmqf"),5);case 5:v=yn.B;case 3:g.gq(yn,6);if(H===void 0)throw Error("prefStorage or opt-in state is undefined");C=[];if(H){yn.bX(8);break}return g.I(yn,jSt(q.B),9);case 9:C=yn.B,C.reverse();case 8:if(!C.length){yn.bX(10);break}Y=g.M(C);N=Y.next();case 11:if(N.done){yn.bX(10);break}b=N.value;
if(!b){yn.bX(12);break}m=g.l$(b).entityId;return g.I(yn,s4(q.B,m),14);case 14:return O=yn.B,O.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.I(yn,y3(m,q.B,{entityKey:b,actionType:J.actionType},q.C,O),12);case 12:N=Y.next();yn.bX(11);break;case 10:return g.I(yn,kEN(H,(F=v)!=null?F:"SD"),16);case 16:return y=yn.B,g.I(yn,Pnu(y),17);case 17:p=T_V(y);if(!q.lX.G("woffle_enable_main_downloads_library")){yn.bX(18);break}if(H){yn.bX(19);break}return g.I(yn,dzN(q.B,g.$6),19);case 19:return g.I(yn,
W3t(q.B,[g.$6]),18);case 18:if((n=p)==null?0:n.length)for(D=g.M(p),h=D.next();!h.done;h=D.next())if(d=X=h.value,z=d.actionType,u=d.entityKey,x4=d.actionMetadata,z&&u&&x4&&!g.f(x4,x_V)){z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(x4.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(iB=g.f(X.actionMetadata,wT))iB.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",X.actionMetadata=Object.assign({},X.actionMetadata,{mainVideoEntityActionMetadata:iB});x.push(X)}g.St(yn,
7);break;case 6:return qP=g.Zi(yn),rq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",qP instanceof g.OQ&&qP.type==="QUOTA_EXCEEDED"&&(rq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yn.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,rq,G));case 7:return yn.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,x))}})},ikt=function(){L0.apply(this,
arguments);
this.X="mainVideoEntity"},HkV=function(q,J,t){J=J===void 0?43200:J;
t=t===void 0?!0:t;var x=x===void 0?!1:x;var k,H,v;return g.U(function(r){switch(r.D){case 1:if(!q.N.Qk())return r.return([]);k=[];g.gq(r,2);return g.I(r,tHB(J,t,x),4);case 4:k=r.B;g.St(r,3);break;case 2:H=g.Zi(r),H instanceof Error&&H.message==="No data"||H instanceof Error&&H.message==="Empty response body"&&xa(H.message);case 3:return v=X1Z(q,k,t,"mainPlaylistEntity"),r.return(v)}})},v95=function(q,J,t,x){x=x===void 0?!1:x;
var k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D;return g.U(function(h){switch(h.D){case 1:return k=[],g.I(h,xkN(),2);case 2:return(H=h.B)||x?g.I(h,iCQ(J,t),3):h.return([]);case 3:v=h.B;if((r=v)==null||!r.length)return h.return([]);C={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Y=g.M(v);N=Y.next();case 4:if(N.done){h.bX(6);break}m=b=N.value;O=m.actionType;F=m.entityKey;y=m.actionMetadata;if(!(O&&F&&y)||g.f(y,x_V)){h.bX(5);break}O==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(y.offlineLoggingData=
C);p=g.l$(F);n=p.entityId;return g.I(h,lg(q,[n],"mainVideoEntity",O,y),8);case 8:D=h.B,k=k.concat(D);case 5:N=Y.next();h.bX(4);break;case 6:return h.return(k)}})},Rvt=function(q,J){this.B=q;
this.C=J},C_u=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n;
return g.U(function(D){switch(D.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,H=[],g.gq(D,2),g.I(D,rIu(q,k),4);case 4:H=D.B;if((v=H)==null||!v.length){D.bX(5);break}return g.I(D,u3x(q.B,J.entityKey),5);case 5:g.St(D,3);break;case 2:return r=g.Zi(D),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.OQ&&r.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
D.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,C,Y));case 3:return N=[],g.I(D,Dzu(q.B,"musicTrack",H),7);case 7:H=D.B;if(H.length)for(b=g.M(H),m=b.next();!m.done;m=b.next())if(O=m.value,F=O.offlineVideoData,y=void 0,(y=F)==null?0:y.videoId)p=void 0,n=Number(((p=J.actionMetadata)==null?void 0:p.priority)||0)+1,N.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",n,V3,Zy(J,F,k)));return D.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,N))}})},
Yk0=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL,Qa,FB,KX,XB,Bt,Q,B,A,P,e,sV,th,cC,k4,Ah,zW,pN,pT,$3,lA;
return g.U(function(LT){switch(LT.D){case 1:return t=rT(J),x=J.entityKey,k=g.l$(x).entityId,H=[],v=!1,k==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.I(LT,GL(q.B,"musicAlbumRelease"),5)):g.I(LT,zL(q.B,x,"musicAlbumRelease"),4);case 4:(r=LT.B)&&H.push(r);LT.bX(3);break;case 5:H=LT.B;case 3:if((C=H)==null||!C.length)return LT.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));if(v){Y=[];N=g.M(H);for(b=N.next();!b.done;b=N.next())m=b.value,O=g.l$(m.id).entityId,Y.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
O,"musicAlbumRelease",0,V3));return LT.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,Y))}F=[];y=H[0];p=void 0;if(!y.downloadMetadata){LT.bX(6);break}return g.I(LT,zL(q.B,y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:n=LT.B,p=Number((h=(D=n)==null?void 0:D.addedTimestampMillis)!=null?h:"0")/1E3;case 6:return g.gq(LT,8),g.I(LT,rIu(q,k,(X=p)==null?void 0:X.toString()),10);case 10:F=LT.B;g.St(LT,9);break;case 8:d=g.Zi(LT);if(!(d instanceof Error&&d.message===
"No data")){if(d instanceof Error&&d.message==="Empty response body")xa(d.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.OQ&&d.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),LT.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,z,u));LT.bX(9);break}return g.I(LT,Dy(k,"musicAlbumRelease",q.B,
J,q.C),9);case 9:x4=[];iB=new Map;if((qP=F)==null?0:qP.length)for(rq=g.M(F),G=rq.next();!G.done;G=rq.next())yn=G.value,nX=yn.offlineVideoData,fX=void 0,((fX=nX)==null?0:fX.videoId)&&iB.set(nX.videoId,nX);SP=new Map;rQ=[];if((Qn=y)==null?0:(Di=Qn.tracks)==null?0:Di.length)for(ix=g.M(y.tracks),S=ix.next();!S.done;S=ix.next())if(RC=S.value,lx=g.l$(RC).entityId)iB.has(lx)?(SP.set(lx,iB.get(lx)),iB.delete(lx)):rQ.push(lx);Qa=Number(((yL=J.actionMetadata)==null?void 0:yL.priority)||0)+1;FB=g.M(iB.entries());
for(KX=FB.next();!KX.done;KX=FB.next())XB=KX.value,Bt=g.M(XB),Q=Bt.next().value,B=Bt.next().value,A=Q,P=B,x4.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"musicTrack",Qa,V3,Zy(J,P)));e=g.M(SP.entries());for(sV=e.next();!sV.done;sV=e.next())th=sV.value,cC=g.M(th),k4=cC.next().value,Ah=cC.next().value,zW=k4,pN=Ah,x4.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",zW,"musicTrack",Qa,V3,Zy(J,pN)));pT=g.M(rQ);for($3=pT.next();!$3.done;$3=pT.next())lA=$3.value,x4.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
lA,"musicTrack",0,V3));return LT.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,x4))}})},NoV=function(q,J){var t,x;
return g.U(function(k){switch(k.D){case 1:return t=rT(J),g.gq(k,2),x=g.l$(J.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.I(k,n0(q.B,J,q.C),5):g.I(k,Dy(x,"musicAlbumRelease",q.B,J,q.C),6);case 6:return g.I(k,wIu(q.B,J.entityKey),5);case 5:g.St(k,3);break;case 2:return g.Zi(k),k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},rIu=function(q,J,t){var x,k,H;
return g.U(function(v){switch(v.D){case 1:return g.I(v,qUx([J]),2);case 2:return x=v.B,g.I(v,bkN(q,x[0],t),3);case 3:return k=v.B,H=Fx(k.thumbnailDetails),g.I(v,gT(H),4);case 4:return v.return(x[0].videos)}})},bkN=function(q,J,t){var x,k,H,v,r,C,Y,N,b,m,O,F,y,p;
return g.U(function(n){if(n.D==1){x=J.additionalMetadadatas;k=void 0;if(x&&x.length>0)for(H=g.M(x),v=H.next();!v.done;v=H.next())if(r=v.value,r.offlineMusicPlaylistData){k=r.offlineMusicPlaylistData;break}C=J.playlistId;Y=VxQ(J);N=Y.Gk;b=Y.Ex;m=t?(Number(t)*1E3).toString():Date.now().toString();O=J.lastModifiedTimestamp?(Number(J.lastModifiedTimestamp)*1E3).toString():"0";F={id:g.u$(C,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:b,lastModifiedTimestampMillis:O,addedTimestampMillis:m,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};y={id:g.u$(C,"musicAlbumRelease"),title:J.title,audioPlaylistId:C,trackCount:J.totalVideoCount,tracks:N,downloadMetadata:F.id};k&&(y.thumbnailDetails=(p=k.albumHqThumbnail)!=null?p:k.albumArtistThumbnail,y.artistDisplayName=k.albumArtistDisplayName,y.releaseDate=k.albumReleaseDate,y.contentRating={explicitType:k.albumReleaseExplicitType},y.releaseType=k.albumReleaseType);return g.I(n,wu(q.B,{mode:"readwrite",HK:!0},function(D){var h=eC(D,y,"musicAlbumRelease");
D=eC(D,F,"musicAlbumReleaseDownloadMetadataEntity");return g.y6.all([h,D])}),2)}return n.return(y)})},m_N=function(q,J){this.B=q;
this.C=J},Fxu=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n;
return g.U(function(D){switch(D.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,H=[],g.gq(D,2),g.I(D,OkP(q,k),4);case 4:H=D.B;if((v=H)==null||!v.length){D.bX(5);break}return g.I(D,u3x(q.B,J.entityKey),5);case 5:g.St(D,3);break;case 2:return r=g.Zi(D),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.OQ&&r.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
D.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,C,Y));case 3:return N=[],g.I(D,Dzu(q.B,"musicTrack",H),7);case 7:H=D.B;if(H.length)for(b=g.M(H),m=b.next();!m.done;m=b.next())if(O=m.value,F=O.offlineVideoData,y=void 0,(y=F)==null?0:y.videoId)p=void 0,n=Number(((p=J.actionMetadata)==null?void 0:p.priority)||0)+1,N.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",n,zU,Zy(J,F,k)));return D.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,N))}})},
E9Q=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S,RC,lx,yL,Qa,FB,KX,XB,Bt,Q,B,A,P,e,sV,th,cC,k4,Ah,zW,pN,pT,$3,lA,LT,uA,ge,NH,Bc,Ei,A5,f8,eF,sA,kv,we;
return g.U(function(H4){switch(H4.D){case 1:return t=rT(J),x=J.entityKey,k=g.l$(x).entityId,H=[],v=!1,k==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.I(H4,GL(q.B,"musicPlaylist"),5)):g.I(H4,zL(q.B,x,"musicPlaylist"),4);case 4:(r=H4.B)&&H.push(r);H4.bX(3);break;case 5:H=H4.B;case 3:if((C=H)==null||!C.length)return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));Y=g.f(J.actionMetadata,zg5);b=(N=Y)==null?void 0:N.autoSync;m=[];F=O=!0;y=!1;p=void 0;if(!v&&b===!1){H4.bX(6);break}g.gq(H4,7);return g.I(H4,
HC5(0,!!b,!0,H),9);case 9:m=H4.B;g.St(H4,8);break;case 7:n=g.Zi(H4);if(!(n instanceof Error&&n.message==="No data")){n instanceof Error&&n.message==="Empty response body"&&xa(n.message);H4.bX(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.I(H4,n0(q.B,J,q.C),8):g.I(H4,Dy(k,"musicPlaylist",q.B,J,q.C),8);case 8:if(!m.length||!v&&m[0].playlistId!==k)return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));case 6:if(v){D=[];h=g.M(m);for(X=h.next();!X.done;X=h.next())d=X.value,d.upToDate||
b&&!d.shouldAutoSyncMetadata||!d.playlistId||(z={autoSync:b},D.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d.playlistId,"musicPlaylist",0,zU,{musicPlaylistEntityActionMetadata:z})));return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,D))}m.length&&(u=m[0],y=!!u.upToDate,b&&(O=(x4=u.shouldAutoSyncMetadata)!=null?x4:!0,F=(iB=u.shouldAutoSyncVideos)!=null?iB:!0,u.checkInSeconds&&(p=u.checkInSeconds)));if(y||!O)return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));qP=[];rq=H[0];G=void 0;if(!rq.downloadMetadata){H4.bX(15);break}return g.I(H4,zL(q.B,rq.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:yn=H4.B,G=Number((fX=(nX=yn)==null?void 0:nX.addedTimestampMillis)!=null?fX:"0")/1E3;case 15:return g.gq(H4,17),g.I(H4,OkP(q,k,(SP=G)==null?void 0:SP.toString(),p),19);case 19:qP=H4.B;g.St(H4,18);break;case 17:rQ=g.Zi(H4);if(!(rQ instanceof Error&&rQ.message==="No data")){if(rQ instanceof Error&&rQ.message==="Empty response body")xa(rQ.message);
else return Qn="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Di="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",rQ instanceof g.OQ&&rQ.type==="QUOTA_EXCEEDED"&&(Qn="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Di="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Qn,Di));H4.bX(18);break}return g.I(H4,Dy(k,"musicPlaylist",q.B,J,q.C),18);case 18:if(!F)return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));ix=[];S=new Map;if((RC=qP)==null?0:RC.length)for(lx=g.M(qP),yL=lx.next();!yL.done;yL=lx.next())Qa=yL.value,FB=Qa.offlineVideoData,KX=void 0,((KX=FB)==null?0:KX.videoId)&&S.set(FB.videoId,FB);XB=new Map;Bt=[];if((Q=rq)==null?0:(B=Q.tracks)==null?0:B.length)for(A=g.M(rq.tracks),P=A.next();!P.done;P=A.next())if(e=P.value,sV=g.l$(e).entityId)S.has(sV)?(XB.set(sV,S.get(sV)),S.delete(sV)):Bt.push(sV);cC=Number(((th=J.actionMetadata)==null?void 0:th.priority)||0)+1;k4=g.M(S.entries());for(Ah=k4.next();!Ah.done;Ah=
k4.next())zW=Ah.value,pN=g.M(zW),pT=pN.next().value,$3=pN.next().value,lA=pT,LT=$3,ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",lA,"musicTrack",cC,zU,Zy(J,LT)));uA=g.M(XB.entries());for(ge=uA.next();!ge.done;ge=uA.next())NH=ge.value,Bc=g.M(NH),Ei=Bc.next().value,A5=Bc.next().value,f8=Ei,eF=A5,ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f8,"musicTrack",cC,zU,Zy(J,eF)));sA=g.M(Bt);for(kv=sA.next();!kv.done;kv=sA.next())we=kv.value,ix.push($a("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
we,"musicTrack",0,zU));return H4.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,ix))}})},cIa=function(q,J){var t,x;
return g.U(function(k){switch(k.D){case 1:return t=rT(J),g.gq(k,2),x=g.l$(J.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.I(k,n0(q.B,J,q.C),5):g.I(k,Dy(x,"musicPlaylist",q.B,J,q.C),6);case 6:return g.I(k,wIu(q.B,J.entityKey),5);case 5:g.St(k,3);break;case 2:return g.Zi(k),k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},OkP=function(q,J,t,x){var k,H,v;
return g.U(function(r){switch(r.D){case 1:return g.I(r,qUx([J]),2);case 2:return k=r.B,g.I(r,MqD(q,k[0],t,x),3);case 3:return H=r.B,v=Fx(H.thumbnailDetails),g.I(r,gT(v),4);case 4:return r.return(k[0].videos)}})},MqD=function(q,J,t,x){var k,H,v,r,C,Y,N,b,m;
return g.U(function(O){return O.D==1?(k=J.playlistId,H=VxQ(J),v=H.Gk,r=H.Ex,C=t?(Number(t)*1E3).toString():Date.now().toString(),Y=J.lastModifiedTimestamp?(Number(J.lastModifiedTimestamp)*1E3).toString():"0",N={id:g.u$(k,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:Y,addedTimestampMillis:C,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},b={id:g.u$(k,"musicPlaylist"),title:J.title,playlistId:k,thumbnailDetails:J.thumbnail,visibility:o9a(J),trackCount:J.totalVideoCount,
tracks:v,downloadMetadata:N.id},x&&(((m=b)==null?0:m.entityMetadata)?b.entityMetadata.nextAutoRefreshIntervalSeconds=String(x):b&&(b.entityMetadata={nextAutoRefreshIntervalSeconds:String(x)})),g.I(O,wu(q.B,{mode:"readwrite",HK:!0},function(F){var y=eC(F,b,"musicPlaylist");F=eC(F,N,"musicPlaylistDownloadMetadataEntity");return g.y6.all([y,F])}),2)):O.return(b)})},o9a=function(q){switch(q.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},g9N=function(q,J){this.B=q;
this.C=J},SkN=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F;
return g.U(function(y){switch(y.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,H=g.f(J.actionMetadata,yIQ),g.gq(y,2),g.I(y,pAN(q,k,void 0,(v=H)==null?void 0:v.track,(r=H)==null?void 0:r.albumRelease),4);case 4:if((C=H)==null?0:C.playlistId){y.bX(5);break}return g.I(y,u3x(q.B,J.entityKey),5);case 5:g.St(y,3);break;case 2:return Y=g.Zi(y),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.OQ&&Y.type==="QUOTA_EXCEEDED"&&
(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,N,b));case 3:O=Number(((m=J.actionMetadata)==null?void 0:m.priority)||0)+1;var p=(p=g.f(J.actionMetadata,yIQ))?{playbackDataActionMetadata:{maximumDownloadQuality:p.maximumDownloadQuality}}:void 0;F=$a("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",O,smx,p);return y.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t,[F]))}})},D_o=function(q,J){var t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p;
return g.U(function(n){switch(n.D){case 1:return t=rT(J),x=g.l$(J.entityKey),k=x.entityId,g.I(n,zL(q.B,J.entityKey,"musicTrack"),2);case 2:H=n.B;if(!H){v=void 0;n.bX(3);break}return g.I(n,zL(q.B,H.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:v=n.B;case 3:r=v;if(!H||!r)return n.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));Y=g.f(J.actionMetadata,yIQ);g.gq(n,5);return g.I(n,pAN(q,k,r.addedTimestampMillis,(N=Y)==null?void 0:N.track,(b=Y)==null?void 0:b.albumRelease),
7);case 7:O=Number(((m=J.actionMetadata)==null?void 0:m.priority)||0)+1;C=$a("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",O,smx);g.St(n,6);break;case 5:F=g.Zi(n);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")xa(F.message);else return y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.OQ&&F.type==="QUOTA_EXCEEDED"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),n.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,y,p));n.bX(6);break}return g.I(n,Sb(k,q.B,J,q.C),6);case 6:return n.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,C?[C]:void 0))}})},n9o=function(q,J){var t,x;
return g.U(function(k){switch(k.D){case 1:return t=rT(J),g.gq(k,2),x=g.l$(J.entityKey).entityId,x==="!*$_ALL_ENTITIES_!*$"?g.I(k,n0(q.B,J,q.C),5):g.I(k,Sb(x,q.B,J,q.C),6);case 6:return g.I(k,wIu(q.B,J.entityKey),5);case 5:g.St(k,3);break;case 2:return g.Zi(k),k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new IZ("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},pAN=function(q,J,t,x,k){var H,v,r,C,Y,N;
return g.U(function(b){switch(b.D){case 1:if(H=x){b.bX(2);break}return g.I(b,aFQ([J]),3);case 3:v=b.B,r=v[0],H=lFa(r);case 2:return g.I(b,ZkQ(q,H,J,k,t),4);case 4:C=b.B;Y=C.musicTrackEntity;N=C.nQ;var m=Fx(Y.thumbnailDetails),O=[];N&&(O=Fx(N.thumbnailDetails));return g.I(b,gT(m.concat(O)),0)}})},ZkQ=function(q,J,t,x,k){var H;
return g.U(function(v){return v.D==1?(k||(k=Date.now().toString()),H={id:g.u$(t,"musicTrackDownloadMetadataEntity"),playbackData:g.u$(t,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.u$(t,"videoDownloadContextEntity")},x&&(J.albumRelease=x.id),g.I(v,wu(q.B,{mode:"readwrite",HK:!0},function(r){var C=[],Y=eC(r,H,"musicTrackDownloadMetadataEntity");C.push(Y);Y=eC(r,J,"musicTrack");C.push(Y);x&&(r=eC(r,x,"musicAlbumRelease"),C.push(r));return g.y6.all(C)}),2)):v.D!=3?g.I(v,bg(t,"musicTrackDownloadMetadataEntity",
q.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):v.return({musicTrackEntity:J,
nQ:x})})},GU=function(){L0.apply(this,arguments);
this.X="musicTrack"},QmD=function(q,J,t){J=J===void 0?43200:J;
t=t===void 0?!0:t;var x=x===void 0?!1:x;var k,H;return g.U(function(v){switch(v.D){case 1:if(!q.N.Qk())return v.return([]);k=[];g.gq(v,2);return g.I(v,HC5(J,t,x),4);case 4:k=v.B;g.St(v,3);break;case 2:g.Zi(v);case 3:return H=X1Z(q,k,t,"musicPlaylist"),v.return(H)}})},BoN=function(){g.bw.apply(this,arguments);
var q=this;this.events=new g.hp(this);this.lX=this.player.U();this.BW={Yc$:function(){return q.B},
Lp:function(){return q.Lp()},
Zk:function(J){return q.Zk(J)}}},AID=function(q){var J;
q=g.f((J=q.getWatchNextResponse())==null?void 0:J.currentVideoEndpoint,g.aq);if(q==null?0:q.playlistId)var t=q.playlistId;return t},$_D=function(q,J){var t,x,k,H;
return g.U(function(v){if(v.D==1){t=J.clientPlaybackNonce;x={cpn:t,offlineSourceVisualElement:g.gK(J.zM||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};J.D&&(x.videoFmt=Number(J.D.itag));J.Y&&(x.audioFmt=Number(J.Y.itag));if((k=AID(J))&&J.videoId){var r=J.videoId;r=k!=="PPSV"?Promise.resolve(!1):q.B.eb(r);v=g.I(v,r,3)}else v=v.bX(2);return v}v.D!=2&&(H=v.B)&&(x.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");q.D=t;g.RK("offlinePlaybackStarted",x);g.oC(v)})};
g.SQ.prototype.le=g.HC(51,function(q){return this.app.le(q)});
g.bZ.prototype.le=g.HC(50,function(q){return g.uxC(this,9,q)});
g.c(Pp,XV);g.vC.Object.defineProperties(Pp.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(q){this.B.entityMetadata=q}}});
g.c(sEt,Pp);sEt.prototype.D=function(){return[]};
g.c(SXo,Pp);SXo.prototype.D=function(){return[]};
g.c(DQD,Pp);DQD.prototype.D=function(){return[]};
g.c(nPP,Pp);nPP.prototype.D=function(){return[]};
g.c(Z8u,Pp);Z8u.prototype.D=function(){var q=[];this.B.alternateChannel&&q.push(this.B.alternateChannel);this.B.alternateChannelList&&q.push.apply(q,g.Z(this.B.alternateChannelList));this.B.oneofChannelEntity&&q.push(this.B.oneofChannelEntity);return[].concat(g.Z(new Set(q)))};
g.c(QEo,Pp);QEo.prototype.D=function(){var q=[];this.B.entryCollection&&q.push(this.B.entryCollection);return[].concat(g.Z(new Set(q)))};
g.c(BgQ,XV);BgQ.prototype.D=function(){var q=[];this.B.video&&q.push(this.B.video);return[].concat(g.Z(new Set(q)))};
g.c(AVQ,Pp);AVQ.prototype.D=function(){var q=[];this.B.parentPlaylist&&q.push(this.B.parentPlaylist);if(this.B.entries)for(var J=g.M(this.B.entries),t=J.next();!t.done;t=J.next())q.push.apply(q,g.Z((new BgQ(t.value)).D()));return[].concat(g.Z(new Set(q)))};
g.c($Qx,Pp);$Qx.prototype.D=function(){var q=[];this.B.descriptionEntity&&q.push(this.B.descriptionEntity);this.B.creators&&q.push.apply(q,g.Z(this.B.creators));this.B.theBiggestFan&&q.push(this.B.theBiggestFan);return[].concat(g.Z(new Set(q)))};
g.c(IJP,Pp);IJP.prototype.D=function(){return[]};
g.c(hVV,Pp);hVV.prototype.D=function(){return[]};
g.c(X_0,Pp);X_0.prototype.D=function(){return[]};
g.c(PRQ,Pp);PRQ.prototype.D=function(){return[]};
g.c(UQZ,Pp);UQZ.prototype.D=function(){return[]};
g.c(TgN,Pp);TgN.prototype.D=function(){return[]};
g.c(jEN,Pp);jEN.prototype.D=function(){return[]};
g.c(KPo,Pp);KPo.prototype.D=function(){return[]};
g.c(WPV,Pp);WPV.prototype.D=function(){return[]};
g.c(dQt,Pp);dQt.prototype.D=function(){var q=[];this.B.downloadsList&&q.push(this.B.downloadsList);this.B.smartDownloadsList&&q.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&q.push(this.B.recommendedDownloadsList);this.B.refresh&&q.push(this.B.refresh);return[].concat(g.Z(new Set(q)))};
g.c(fJP,XV);fJP.prototype.D=function(){var q=[];this.B.video&&q.push(this.B.video);this.B.playlist&&q.push(this.B.playlist);this.B.videoItem&&q.push(this.B.videoItem);this.B.playlistItem&&q.push(this.B.playlistItem);return[].concat(g.Z(new Set(q)))};
g.c(eVP,Pp);eVP.prototype.D=function(){var q=[];this.B.refresh&&q.push(this.B.refresh);if(this.B.downloads)for(var J=g.M(this.B.downloads),t=J.next();!t.done;t=J.next())q.push.apply(q,g.Z((new fJP(t.value)).D()));return[].concat(g.Z(new Set(q)))};
g.c(LPt,Pp);LPt.prototype.D=function(){var q=[];this.B.localImageEntities&&q.push.apply(q,g.Z(this.B.localImageEntities));return[].concat(g.Z(new Set(q)))};
g.c(lJ5,Pp);lJ5.prototype.D=function(){var q=[];this.B.playbackData&&q.push(this.B.playbackData);this.B.localImageEntities&&q.push.apply(q,g.Z(this.B.localImageEntities));this.B.videoDownloadContextEntity&&q.push(this.B.videoDownloadContextEntity);return[].concat(g.Z(new Set(q)))};
g.c(uHD,Pp);uHD.prototype.D=function(){return[]};
g.c(w_D,Pp);w_D.prototype.D=function(){var q=[];this.B.fakeChildren&&q.push.apply(q,g.Z(this.B.fakeChildren));return[].concat(g.Z(new Set(q)))};
g.c(VF0,Pp);VF0.prototype.D=function(){var q=[];this.B.video&&q.push(this.B.video);this.B.playbackData&&q.push(this.B.playbackData);this.B.offlineVideoPolicy&&q.push(this.B.offlineVideoPolicy);return[].concat(g.Z(new Set(q)))};
g.c(zVZ,Pp);zVZ.prototype.D=function(){return[]};
g.c(GxN,Pp);GxN.prototype.D=function(){var q=[];this.B.channelOwner&&q.push(this.B.channelOwner);this.B.videos&&q.push.apply(q,g.Z(this.B.videos));this.B.collaboratorChannels&&q.push.apply(q,g.Z(this.B.collaboratorChannels));this.B.downloadState&&q.push(this.B.downloadState);this.B.refresh&&q.push(this.B.refresh);return[].concat(g.Z(new Set(q)))};
g.c(aJo,Pp);aJo.prototype.D=function(){var q=[];this.B.video&&q.push(this.B.video);this.B.channelContributor&&q.push(this.B.channelContributor);return[].concat(g.Z(new Set(q)))};
g.c(qT0,XV);qT0.prototype.D=function(){var q=[];this.B.localImageEntities&&q.push.apply(q,g.Z(this.B.localImageEntities));this.B.videoDownloadContextEntity&&q.push(this.B.videoDownloadContextEntity);return[].concat(g.Z(new Set(q)))};
g.c(Jvt,XV);Jvt.prototype.D=function(){var q=[];this.B.recommendedVideoMetadata&&q.push.apply(q,g.Z((new qT0(this.B.recommendedVideoMetadata)).D()));return[].concat(g.Z(new Set(q)))};
g.c(tcN,XV);tcN.prototype.D=function(){var q=[];this.B.playbackPosition&&q.push(this.B.playbackPosition);return[].concat(g.Z(new Set(q)))};
g.c(xhQ,Pp);xhQ.prototype.D=function(){var q=[];this.B.owner&&q.push(this.B.owner);this.B.downloadState&&q.push(this.B.downloadState);this.B.userState&&q.push.apply(q,g.Z((new tcN(this.B.userState)).D()));this.B.additionalMetadata&&q.push.apply(q,g.Z((new Jvt(this.B.additionalMetadata)).D()));return[].concat(g.Z(new Set(q)))};
g.c(k8Z,Pp);k8Z.prototype.D=function(){var q=[];this.B.userChannelDetails&&q.push(this.B.userChannelDetails);return[].concat(g.Z(new Set(q)))};
g.c(i3t,Pp);i3t.prototype.D=function(){var q=[];this.B.channelOwner&&q.push(this.B.channelOwner);this.B.playbackPosition&&q.push(this.B.playbackPosition);this.B.localImageEntities&&q.push.apply(q,g.Z(this.B.localImageEntities));this.B.downloadStatus&&q.push(this.B.downloadStatus);return[].concat(g.Z(new Set(q)))};
g.c(H3V,Pp);H3V.prototype.D=function(){return[]};
g.c(vwD,Pp);vwD.prototype.D=function(){return[]};
g.c(R1t,Pp);R1t.prototype.D=function(){return[]};
g.c(rvB,Pp);rvB.prototype.D=function(){return[]};
g.c(CJN,Pp);CJN.prototype.D=function(){return[]};
g.c(YTP,Pp);YTP.prototype.D=function(){return[]};
g.c(N4B,Pp);N4B.prototype.D=function(){return[]};
g.c(b3D,Pp);b3D.prototype.D=function(){return[]};
g.c(mho,Pp);mho.prototype.D=function(){return[]};
g.c(O3D,Pp);O3D.prototype.D=function(){return[]};
g.c(FQQ,Pp);FQQ.prototype.D=function(){return[]};
g.c(EwQ,Pp);EwQ.prototype.D=function(){var q=[];this.B.trackDownloadMetadatas&&q.push.apply(q,g.Z(this.B.trackDownloadMetadatas));return[].concat(g.Z(new Set(q)))};
g.c(cvB,Pp);
cvB.prototype.D=function(){var q=[];this.B.downloadedTracks&&q.push.apply(q,g.Z(this.B.downloadedTracks));this.B.smartDownloadedTracks&&q.push.apply(q,g.Z(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&q.push.apply(q,g.Z(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&q.push.apply(q,g.Z(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&q.push.apply(q,g.Z(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&q.push.apply(q,g.Z(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
q.push.apply(q,g.Z(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&q.push.apply(q,g.Z(this.B.metadataOnlyTracks));return[].concat(g.Z(new Set(q)))};
g.c(McV,Pp);McV.prototype.D=function(){var q=[];this.B.trackDownloadMetadatas&&q.push.apply(q,g.Z(this.B.trackDownloadMetadatas));return[].concat(g.Z(new Set(q)))};
g.c(owa,Pp);owa.prototype.D=function(){var q=[];this.B.playbackData&&q.push(this.B.playbackData);this.B.localImageEntities&&q.push.apply(q,g.Z(this.B.localImageEntities));this.B.videoDownloadContextEntity&&q.push(this.B.videoDownloadContextEntity);return[].concat(g.Z(new Set(q)))};
g.c(gwP,Pp);gwP.prototype.D=function(){var q=[];this.B.musicLibraryStatusEntity&&q.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&q.push.apply(q,g.Z(this.B.primaryArtists));this.B.details&&q.push(this.B.details);this.B.userDetails&&q.push(this.B.userDetails);this.B.tracks&&q.push.apply(q,g.Z(this.B.tracks));this.B.share&&q.push(this.B.share);this.B.downloadMetadata&&q.push(this.B.downloadMetadata);this.B.refresh&&q.push(this.B.refresh);return[].concat(g.Z(new Set(q)))};
g.c(yv0,Pp);yv0.prototype.D=function(){var q=[];this.B.albumRelease&&q.push(this.B.albumRelease);this.B.tracks&&q.push.apply(q,g.Z(this.B.tracks));return[].concat(g.Z(new Set(q)))};
g.c(pit,Pp);pit.prototype.D=function(){var q=[];this.B.albumRelease&&q.push(this.B.albumRelease);return[].concat(g.Z(new Set(q)))};
g.c(sr5,Pp);sr5.prototype.D=function(){var q=[];this.B.details&&q.push(this.B.details);this.B.userDetails&&q.push(this.B.userDetails);return[].concat(g.Z(new Set(q)))};
g.c(STQ,Pp);STQ.prototype.D=function(){var q=[];this.B.parentArtist&&q.push(this.B.parentArtist);return[].concat(g.Z(new Set(q)))};
g.c(Dhx,Pp);Dhx.prototype.D=function(){var q=[];this.B.parentArtist&&q.push(this.B.parentArtist);return[].concat(g.Z(new Set(q)))};
g.c(nwQ,Pp);nwQ.prototype.D=function(){return[]};
g.c(Z3N,Pp);Z3N.prototype.D=function(){return[]};
g.c(QrB,XV);QrB.prototype.D=function(){var q=[];this.B.creatorEntity&&q.push(this.B.creatorEntity);return[].concat(g.Z(new Set(q)))};
g.c(B4P,Pp);
B4P.prototype.D=function(){var q=[];this.B.tracks&&q.push.apply(q,g.Z(this.B.tracks));this.B.refresh&&q.push(this.B.refresh);this.B.musicLibraryStatusEntity&&q.push(this.B.musicLibraryStatusEntity);this.B.details&&q.push(this.B.details);this.B.downloadMetadata&&q.push(this.B.downloadMetadata);this.B.sideloadMetadata&&q.push(this.B.sideloadMetadata);this.B.userDetails&&q.push(this.B.userDetails);this.B.entryCollection&&q.push(this.B.entryCollection);this.B.share&&q.push(this.B.share);this.B.podcastShowAdditionalMetadata&&q.push.apply(q,
g.Z((new QrB(this.B.podcastShowAdditionalMetadata)).D()));return[].concat(g.Z(new Set(q)))};
g.c(Ava,Pp);Ava.prototype.D=function(){return[]};
g.c($hB,Pp);
$hB.prototype.D=function(){var q=[];this.B.musicLibraryStatusEntity&&q.push(this.B.musicLibraryStatusEntity);this.B.artists&&q.push.apply(q,g.Z(this.B.artists));this.B.audioModeVersion&&q.push(this.B.audioModeVersion);this.B.videoModeVersion&&q.push(this.B.videoModeVersion);this.B.userDetails&&q.push(this.B.userDetails);this.B.details&&q.push(this.B.details);this.B.albumRelease&&q.push(this.B.albumRelease);this.B.share&&q.push(this.B.share);this.B.libraryEdit&&q.push(this.B.libraryEdit);this.B.downloadMetadata&&
q.push(this.B.downloadMetadata);this.B.playbackPosition&&q.push(this.B.playbackPosition);this.B.lyrics&&q.push(this.B.lyrics);return[].concat(g.Z(new Set(q)))};
g.c(IHN,Pp);IHN.prototype.D=function(){var q=[];this.B.parentTrack&&q.push(this.B.parentTrack);return[].concat(g.Z(new Set(q)))};
g.c(h1x,Pp);h1x.prototype.D=function(){var q=[];this.B.parentTrack&&q.push(this.B.parentTrack);return[].concat(g.Z(new Set(q)))};
g.c(XiN,Pp);XiN.prototype.D=function(){return[]};
g.c(PJD,Pp);PJD.prototype.D=function(){return[]};
g.c(Uha,Pp);Uha.prototype.D=function(){return[]};
g.c(T45,Pp);T45.prototype.D=function(){return[]};
g.c(jr5,Pp);jr5.prototype.D=function(){var q=[];this.B.transfer&&q.push(this.B.transfer);this.B.adsPlaybackData&&q.push.apply(q,g.Z(this.B.adsPlaybackData));this.B.drmLicense&&q.push(this.B.drmLicense);this.B.offlineVideoPolicy&&q.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&q.push(this.B.videoDownloadContextEntity);return[].concat(g.Z(new Set(q)))};
g.c(KQ5,Pp);KQ5.prototype.D=function(){return[]};
g.c(WQu,Pp);WQu.prototype.D=function(){var q=[];this.B.offlineVideoStreams&&q.push.apply(q,g.Z(this.B.offlineVideoStreams));this.B.captionTrack&&q.push.apply(q,g.Z(this.B.captionTrack));return[].concat(g.Z(new Set(q)))};
g.c(dht,Pp);dht.prototype.D=function(){return[]};
g.c(fHQ,Pp);fHQ.prototype.D=function(){return[]};
g.c(e1V,Pp);e1V.prototype.D=function(){return[]};
g.c(LQ5,Pp);LQ5.prototype.D=function(){return[]};
g.c(lHB,Pp);lHB.prototype.D=function(){return[]};
g.c(uqN,Pp);uqN.prototype.D=function(){return[]};
g.c(wi5,Pp);wi5.prototype.D=function(){return[]};
g.c(Vcu,Pp);Vcu.prototype.D=function(){return[]};
g.c(z1N,Pp);z1N.prototype.D=function(){return[]};
g.c(G8B,Pp);G8B.prototype.D=function(){return[]};
g.c(aHP,Pp);aHP.prototype.D=function(){return[]};
g.c(q9u,Pp);q9u.prototype.D=function(){return[]};
g.c(J9Q,Pp);J9Q.prototype.D=function(){return[]};
g.c(tIN,Pp);tIN.prototype.D=function(){return[]};
g.c(xgt,Pp);xgt.prototype.D=function(){return[]};
g.c(kaN,Pp);kaN.prototype.D=function(){return[]};
g.c(iZx,Pp);iZx.prototype.D=function(){return[]};
g.c(HZB,Pp);HZB.prototype.D=function(){return[]};
g.c(v2V,Pp);v2V.prototype.D=function(){return[]};
g.c(RLN,Pp);RLN.prototype.D=function(){return[]};
var voa=["browse","music/browse","unplugged/browse"],NGo=["offline/playlist_sync_check"],GbN=["offline"],RQP=["offline/offline_video_playback_position_sync"],C8Q=["offline/get_playback_data_entity"],Uj;TL.getInstance=function(){return g.U(function(q){return q.return(new Promise(function(J){g.V6().then(function(t){t?(TL.instance||(TL.instance=new TL(t)),J(TL.instance)):J(void 0)})}))})};
TL.prototype.get=function(q){var J=this,t,x,k;return g.U(function(H){if(H.D==1)return g.I(H,Npa(J.token),2);if(H.D!=3)return t=H.B,g.I(H,t.get("prefs",q),3);x=H.B;if(!x)return H.return();k=(0,g.L)();return x.expirationTimestampMs<=k?H.return():H.return(x.value)})};
TL.prototype.set=function(q,J,t){t=t===void 0?31536E3:t;var x=this,k,H,v;return g.U(function(r){if(r.D==1)return k=(0,g.L)(),H={key:q,value:J,expirationTimestampMs:k+t*1E3},g.I(r,Npa(x.token),2);v=r.B;return g.I(r,g.AA(v,"prefs",H),0)})};
TL.prototype.remove=function(q){var J=this,t;return g.U(function(x){if(x.D==1)return g.I(x,Npa(J.token),2);t=x.B;return g.I(x,t.delete("prefs",q),0)})};
g.c(jC,g.LP);g.c(Ky,E2P);Ky.prototype.C=function(q,J){J=MIx(J);q=(new TextEncoder).encode(JSON.stringify(q));return this.B.encrypt(q,J)};
Ky.prototype.D=function(q,J){if(!(q instanceof Uint8Array))throw bZo(1);var t=new TextDecoder;J=MIx(J);q=this.B.decrypt(q,J);return JSON.parse(t.decode(q))};
var o2a={accountLinkStatusEntity:X_0,booleanEntity:DQD,buttonEntity:J9Q,captionTrack:XiN,channelHandle:sEt,commerceAcquisitionClientPayloadEntity:xgt,commerceCartListEntity:kaN,contextNoteFeedEntityPayload:SXo,continuationTokenEntity:zVZ,downloadQualityPickerEntity:jEN,downloadsPageRefreshTokenEntity:WPV,downloadsPageViewConfigurationEntity:H3V,downloadStatusEntity:KPo,dismissState:wi5,sfvAudioItemCurrentlyPlayingEntity:LQ5,emojiFountainDataEntity:aHP,emojiCustomizationSetEntity:G8B,fakeChannel:Z8u,
fakePlaylist:QEo,fakePlaylistEntryCollection:AVQ,fakeVideo:$Qx,fakeVideoDescription:IJP,featuredProductsEntity:mho,flowStateEntity:hVV,iconBadgeEntity:iZx,interstitialInteractionStateEntity:UQZ,likeButtonAnimationEntity:vwD,liveChatPollStateEntity:TgN,liveViewerLeaderboardChatEntryPointStateEntity:fHQ,liveViewerLeaderboardPointsEntity:e1V,liveReactionsDataEntity:q9u,logoEntity:PRQ,macroMarkerEntity:R1t,mainDownloadsLibraryEntity:dQt,mainDownloadsListEntity:eVP,mainPlaylistDownloadStateEntity:LPt,
mainPlaylistEntity:GxN,mainPlaylistVideoEntity:aJo,mainVideoDownloadStateEntity:lJ5,mainVideoEntity:xhQ,markersEngagementPanelSyncEntity:rvB,markersVisibilityOverrideEntity:CJN,musicAlbumReleaseDetail:yv0,musicAlbumReleaseDownloadMetadataEntity:EwQ,musicAlbumRelease:gwP,musicAlbumReleaseUserDetail:pit,musicArtistDetail:STQ,musicArtist:sr5,musicArtistUserDetail:Dhx,musicDownloadsLibraryEntity:cvB,musicLibraryEdit:nwQ,musicLibraryStatusEntity:Z3N,musicPlaylist:B4P,musicPlaylistDownloadMetadataEntity:McV,
musicShare:Ava,musicTrackDetail:IHN,musicTrackDownloadMetadataEntity:owa,musicTrack:$hB,musicTrackUserDetail:h1x,offlineOrchestrationActionWrapperEntity:PJD,offlineVideoPolicy:Uha,offlineVideoStreams:T45,offlineabilityEntity:uHD,orchestrationWebSamplingEntity:w_D,pageHeaderEntity:Vcu,pdpStateEntity:HZB,pinnedProductEntity:O3D,playbackData:jr5,playerStateEntity:YTP,quantityIncrementerEntity:v2V,refresh:KQ5,saveToPlaylistListEntity:lHB,settingEntity:uqN,stringEntity:nPP,suggestedFeedbackChipStateEntity:N4B,
transfer:WQu,trendingOfferEntity:FQQ,videoDownloadContextEntity:dht,videoOverviewAsyncDataEntity:RLN,videoPlaybackPositionEntity:tIN,votingEntity:z1N,ytMainChannelEntity:k8Z,youchatPendingResponseEntity:b3D,ytMainDownloadedVideoEntity:VF0,ytMainVideoEntity:i3t};g.c(lE,E2P);lE.prototype.C=function(q){return q};
lE.prototype.D=function(q){if(q instanceof Uint8Array)throw bZo(0);return q};
g.c(uE,g.K);uE.prototype.observe=function(q){var J=this;this.observers.push(q);return function(){var t=J.observers.indexOf(q);t>=0&&J.observers.splice(t,1)}};
uE.prototype.D=function(q){hLt(this,q.data)};
uE.prototype.CC=function(){this.channel.close()};
var j6x,Uzx=new g.sk("elementsCommand");var p0=new g.sk("entityBatchUpdate");var Seu=new g.sk("downloadStatusEntity");var WMt=new g.sk("mainPlaylistEntityActionMetadata");var wT=new g.sk("mainVideoEntityActionMetadata");var zg5=new g.sk("musicPlaylistEntityActionMetadata");var yIQ=new g.sk("musicTrackEntityActionMetadata");var x_V=new g.sk("localImageEntityActionMetadata");var hz=new g.sk("playbackDataActionMetadata");var TGB=new g.sk("transferEntityActionMetadata");var p75=new g.sk("videoPlaybackPositionEntityActionMetadata");var JJu;new g.YK;new g.YK;HnQ.prototype.request=function(q,J,t){J=J===void 0?{}:J;return this.locks.request(q,J,function(x){return t(x)})};var tz=g.uB.caches,Jz,YeN;qt.prototype.open=function(q){return tz.open(rJQ(q))};
qt.prototype.has=function(q){return tz.has(rJQ(q))};
qt.prototype.delete=function(q){return tz.delete(rJQ(q))};
qt.prototype.match=function(q,J){var t=this,x,k,H,v,r,C;return g.U(function(Y){switch(Y.D){case 1:return g.I(Y,t.keys(),2);case 2:x=Y.B,k=g.M(x),H=k.next();case 3:if(H.done){Y.bX(5);break}v=H.value;return g.I(Y,t.open(v),6);case 6:return r=Y.B,g.I(Y,r.match(q,J),7);case 7:if(C=Y.B)return Y.return(C);H=k.next();Y.bX(3);break;case 5:return Y.return()}})};
g.c(RgP,qt);RgP.prototype.keys=function(){var q,J,t,x,k,H,v,r,C;return g.U(function(Y){if(Y.D==1)return q=[],J=g.lY("CacheStorage keys"),g.I(Y,tz.keys(),2);t=Y.B;x=g.M(t);for(k=x.next();!k.done;k=x.next()){H=k.value;var N=H.indexOf(":");v=N===-1?{q7:H}:{q7:H.substring(0,N),datasyncId:H.substring(N+1)};r=v.q7;C=v.datasyncId;C===J&&q.push(r)}return Y.return(q)})};g.c(ka,g.K);ka.prototype.C=function(q){this.api.Sr("onOfflineOperationFailure",q.data)};
ka.prototype.Y=function(q){this.api.publish("offlinetransferpause",q.data)};
ka.prototype.CC=function(){var q;(q=this.B)==null||q.close();var J;(J=this.D)==null||J.close()};mzQ.prototype.Un=function(){this.B&&Hh(this)};
mzQ.prototype.BH=function(){this.D&&this.D.resolve();this.C=this.B=!1;this.X()};var JLo=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var hg0="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var L3x="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.c(mkB,Az);mkB.prototype.D=function(q){return C0(q)?EoZ(this,q):Ya(q)?oox(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};g.c(goB,Az);goB.prototype.D=function(q){return Ya(q)?yqu(this,q):sSo(q)?sl5(this,q):Nt(q)?SUV(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};g.E=Dkt.prototype;g.E.ecw=function(q){var J=this,t,x,k,H;return g.U(function(v){if(!g.w(q.state,128))return v.bX(0);t=q.state.fR;var r=(x=t)==null?void 0:x.errorCode,C=(k=t)==null?void 0:k.ww;H=r==="net.connect"&&C===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(r==null?0:r.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.I(v,J.Vu(J.player.getVideoData().videoId,H),0)})};
g.E.Vu=function(q,J){var t=this;return g.U(function(x){if(x.D==1){if(t.D)return x.return();t.D=!0;return J==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(U4(t,q,!1,!0),x.bX(0)):g.I(x,Ph(t,q),3)}g.AQ(q,4);return g.I(x,t.B.Vu(J),0)})};
g.E.jd=function(q){q.status===2?(q.status!==this.C&&(yLu(this.B),g.AQ(q.videoId,2)),q.Px&&niN(this.B,q.videoId,q.Px)):q.status===4?(Ph(this,q.videoId),this.Vu(q.videoId,q.Sj?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):q.status===1&&DuB(this.B);this.C=q.status;this.api.Sr("localmediachange",{videoId:q.videoId,status:q.status})};
g.E.JF=function(){var q=this,J;return g.U(function(t){if(t.D==1){if(q.D)return t.return();q.D=!0;J=q.player.getVideoData().videoId;return g.I(t,Ph(q,J),2)}return g.I(t,q.B.JF(),0)})};
g.E.yc=function(q){switch(q){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.E.G=function(q){return this.api.U().G(q)};g.c(IZQ,Az);IZQ.prototype.D=function(q){return C0(q)?X70(this,q):Ya(q)?P8o(this,q):sSo(q)?UkQ(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};fZQ.prototype.B=function(q,J){var t=q.action.actionMetadata.priority-J.action.actionMetadata.priority;t===0&&(q.B<J.B?t=-1:q.B>J.B&&(t=1));return t};g.c(TU,g.K);TU.prototype.CC=function(){this.X&&this.X();g.K.prototype.CC.call(this)};
TU.prototype.createAction=function(q,J){var t=g.l$(q.entityKey).entityType,x=g.gS(16);return new E4(t,x,q,J.actionId,J.rootActionId)};
TU.prototype.s4=function(q){var J=this,t,x,k,H,v,r,C,Y,N;return g.U(function(b){if(b.D==1){if(J.pC())return b.return();x=(t=q.offlineOrchestrationActionWrapperEntity)!=null?t:new Set;k=[];H=g.M(x);for(v=H.next();!v.done;v=H.next())r=v.value,C=g.l$(r),Y=C.entityId,lZN(J.B,Y)||k.push(r);return g.I(b,kpZ(J,k),2)}N=b.B;return g.I(b,xuZ(J,N),0)})};
TU.prototype.retry=function(){var q=this;return g.U(function(J){return g.I(J,iKP(q),0)})};viQ.prototype.q4=function(q,J){J=J===void 0?!0:J;var t=this,x,k,H,v,r,C,Y,N;return g.U(function(b){switch(b.D){case 1:if(!t.B)return b.return();x=[];k=g.qm(t.B.D,J);H=[];for(v={l5:0};v.l5<k.length;v={l5:v.l5},v.l5++)r=k[v.l5],C=t.B.VU(r,"json3"),Y=g.Z2(C,{withCredentials:!0,format:"RAW"},3,500).then(function(m){return function(O){O={metadata:g.Ot(k[m.l5]),trackData:O.xhr.responseText};H.push(O)}}(v)).gp(function(m){xa("Caption fetch error",m)}),x.push(Y);
return g.I(b,p_Q(x),2);case 2:return g.gq(b,3),g.I(b,uAN(q,H),5);case 5:g.St(b,0);break;case 3:N=g.Zi(b),xa("Caption DB transaction error",N),g.oC(b)}})};g.c(jb,g.K);jb.prototype.CC=function(){this.D&&this.D();g.K.prototype.CC.call(this)};
jb.prototype.C=function(q){var J=this,t,x,k,H,v,r,C,Y;return g.U(function(N){x=(t=q.transfer)!=null?t:new Set;k=[];H=g.M(x);for(v=H.next();!v.done;v=H.next())r=v.value,C=g.l$(r),Y=C.entityId,k.push(Y);return k.length===0?N.return():g.I(N,CIt(J,k),0)})};g.c(OKN,g.K);g.E=OKN.prototype;g.E.CC=function(){this.xZ&&this.xZ();this.Qw.dispose();this.Y.dispose();this.zM&&g.G8(this.N.jF,this.zM);this.F_&&g.G8(this.N.jF,this.F_);g.K.prototype.CC.call(this)};
g.E.JKw=function(q){var J=this,t,x,k;return g.U(function(H){switch(H.D){case 1:t=g.u$(q,"transfer");if(J.B&&t===J.B.key){U4(J.L,J.V,!0);J.Y.stop();H.bX(0);break}return g.I(H,wu(J.D,{mode:"readwrite",HK:!0},function(v){return Wp(v,t,"transfer").then(function(r){if(r&&r.transferState!=="TRANSFER_STATE_COMPLETE"&&r.transferState!=="TRANSFER_STATE_FAILED")return r.transferState="TRANSFER_STATE_PAUSED_BY_USER",eC(v,r,"transfer").then(function(){return r})})}),3);
case 3:x=H.B;if(!x){H.bX(0);break}if(!q||!J.C){H.bX(5);break}return g.I(H,bg(q,J.C,J.D,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.I(H,dT(J,q),7);case 7:k=H.B,yJ0({videoId:q,JD:x,offlineModeType:k}),g.oC(H)}})};
g.E.v1X=function(){var q=this;if(this.B&&this.V){U4(this.L,this.V,!1);var J=this.B,t=(J==null?0:J.key)?g.l$(J.key).entityId:"";t&&this.C&&(new Promise(function(x,k){bg(t,q.C,q.D,"DOWNLOAD_STATE_PAUSED").catch(function(H){k(H)})})).catch(function(x){xa("Download state setting error",x)})}this.Y.stop()};
g.E.k9=function(){this.B?cLZ(this,this.B):Wh(this)};
g.E.Ac=function(q){var J=this;return g.U(function(t){switch(t.D){case 1:if(!J.B){t.bX(2);break}if(J.B.transferState==="TRANSFER_STATE_COMPLETE"||J.B.transferState==="TRANSFER_STATE_FAILED"||!q.transfer||!q.transfer.has(J.B.key)){t.bX(3);break}return g.I(t,zL(J.D,J.B.key,"transfer"),4);case 4:J.B=t.B;if(J.B){t.bX(3);break}return g.I(t,MrZ(J),3);case 3:if(J.B)return t.return();case 2:return g.I(t,Wh(J),0)}})};
g.E.Vu=function(q,J){var t=this,x,k,H,v,r;return g.U(function(C){switch(C.D){case 1:if(!t.B){f0(t,"onTransferFailure: "+q);C.bX(2);break}x=t.B;H=((k=x)==null?0:k.key)?g.l$(x.key).entityId:"";a:switch(q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Y=!1;break a;default:Y=!0}return Y&&ZKt(t)?g.I(C,eb(t,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.I(C,
Q4Q(t,q),5);case 5:if(!H||!t.C){C.bX(2);break}return g.I(C,bg(H,t.C,t.D,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.I(C,dT(t,H),9);case 9:v=C.B;RZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:H,JD:x,offlineModeType:v});if(!H||!t.C){C.bX(2);break}return g.I(C,bg(H,t.C,t.D,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:K0(t),r=Wh(t,!0),J&&J(r),g.oC(C)}})};
g.E.JF=function(q){var J=this,t,x,k,H,v,r,C,Y,N,b,m,O;return g.U(function(F){switch(F.D){case 1:if(!J.B){f0(J,"onMaybeTransferStreamsExpired");F.bX(2);break}return ZKt(J)?g.I(F,eb(J,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.I(F,Q4Q(J,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!J.C){F.bX(2);break}t=J.B;k=((x=t)==null?0:x.key)?g.l$(t.key).entityId:"";if(!k){F.bX(2);break}return g.I(F,bg(k,J.C,J.D,"DOWNLOAD_STATE_FAILED"),2);case 9:return J.B||f0(J,"onMaybeTransferStreamsExpiredRetryAttempting"),
H=J.B,r=((v=H)==null?0:v.key)?g.l$(H.key).entityId:"",g.I(F,dT(J,r),10);case 10:return C=F.B,RZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:r,JD:H,offlineModeType:C}),Y=ZnZ(),g.Tk(Y,hz,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N=g.u$(r,"playbackData"),b={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:N,actionMetadata:Y},m=Mt(new E4("playbackData",r,b)),g.I(F,Vu(J.D,m,"offlineOrchestrationActionWrapperEntity"),2);case 2:K0(J),O=Wh(J,!0),
q&&q(O),g.oC(F)}})};
var ImZ={},Bf5=(ImZ.TRANSFER_STATE_TRANSFERRING=1,ImZ.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ImZ);g.E=L0.prototype;g.E.qI=function(){return this.V.promise};
g.E.SV=function(){if(this.D&&this.L)return this.V.promise;IVo(this).then(this.V.resolve).catch(this.V.reject);return this.V.promise};
g.E.o3=function(q){var J={};return J.playbackData=new mkB(q,this.lX,this.B),J.transfer=new IZQ(q,this.lX),J.videoPlaybackPositionEntity=new goB(q,this.lX),J};
g.E.CX=function(){var q=this;return g.U(function(J){return q.D?g.I(J,FMo(q.D),0):J.bX(0)})};
g.E.UM=function(){var q=this,J,t;return g.U(function(x){if(x.D==1)return q.D||q.L?g.I(x,q.qI(),2):x.return();q.W!==void 0&&(g.EK(q.W),q.W=void 0);q.Y!==void 0&&(g.EK(q.Y),q.Y=void 0);(J=q.D)==null||J.dispose();q.D=void 0;(t=q.L)==null||t.dispose();q.L=void 0;q.api.Sr("onOrchestrationLostLeader");q.V=new g.YK;g.oC(x)})};
g.E.isOrchestrationLeader=function(){return this.C.B};
g.E.eb=function(){return g.U(function(q){return q.return(!1)})};
g.E.Ml=function(q){var J=this.B;J.api.publish("offlinetransferpause",q);var t;(t=J.D)==null||t.postMessage(q)};
g.E.k9=function(q){var J,t;return g.U(function(x){if(x.D==1)return g.I(x,at(),2);J=x.B;if(!J)return x.return();t=g.u$(q,"transfer");return g.I(x,wu(J,{mode:"readwrite",HK:!0},function(k){var H=Wp(k,t,"transfer"),v=Wp(k,g.u$(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.y6.all([H,v]).then(function(r){r=g.M(r);var C=r.next().value;var Y=r.next().value;return C&&C.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",eC(k,C,"transfer").then(function(){RZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:q,JD:C,offlineModeType:Y==null?void 0:Y.offlineModeType});return g.y6.resolve(null)})):g.y6.resolve(null)})}),0)})};
g.E.Eu=function(q){q=q===void 0?43200:q;var J=this,t,x,k,H,v,r,C,Y;return g.U(function(N){if(N.D==1)return J.N.Qk()?g.I(N,at(),2):N.return(hfV());if(N.D!=3){t=N.B;if(!t)return N.return([]);x=Date.now()/1E3;return g.I(N,GL(t,"offlineVideoPolicy"),3)}k=N.B;H=[];v=g.M(k);for(r=v.next();!r.done;r=v.next())C=r.value,Number(C.lastUpdatedTimestampSeconds)+q<=x&&(Y=g.l$(C.key).entityId,H.push(Y));return H.length?N.return(lg(J,H,J.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):N.return([])})};
g.E.deleteAll=function(){return lg(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.E.refreshAllStaleEntities=function(q){var J=this;return g.U(function(t){return t.D==1?g.I(t,J.Eu(q),2):t.return(t.B)})};
g.E.setUpPositionSyncInterval=function(q){var J=this;this.Y!==void 0&&(g.EK(this.Y),this.Y=void 0);var t=q!=null?q:864E5;this.Y=g.OK(function(){J.aN(t)},t)};
g.E.aN=function(q){var J=this,t,x,k,H,v,r;return g.U(function(C){switch(C.D){case 1:return g.gq(C,2),g.I(C,TL.getInstance(),4);case 4:t=C.B;if(!t)throw Error("prefStorage is undefined");return g.I(C,t.get("psi"),5);case 5:x=C.B;H=((k=x)==null?0:k.Wi)?Number(x.Wi)/1E3:0;v=Date.now();if(!(H+q<=v)){C.bX(6);break}return g.I(C,lg(J,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.St(C,0);break;case 2:r=g.Zi(C),xa("Offline manager error",r),
g.oC(C)}})};
g.E.nX=function(){var q=this,J,t,x,k,H,v,r;return g.U(function(C){if(C.D==1)return g.I(C,at(),2);if(C.D!=3)return(J=C.B)?g.I(C,GL(J,"transfer"),3):C.return([]);t=C.B;x=[];k=g.M(t);for(H=k.next();!H.done;H=k.next())v=H.value,v.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&v.key&&(r=g.l$(v.key).entityId,x.push(r));return C.return(PIV(q,x))})};
g.E.Xi=function(){return g.U(function(q){return q.return([])})};
g.E.S0=function(){return g.U(function(q){g.oC(q)})};
g.E.MN=function(){return g.U(function(q){g.oC(q)})};g.c(UuB,Az);UuB.prototype.D=function(q){return C0(q)?KMo(this,q):Ya(q)?dux(this,q):Nt(q)?fVD(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};
var ug=[10];g.c(w10,Az);w10.prototype.D=function(q){return C0(q)?GpQ(this,q):Ya(q)?aVD(this,q):Nt(q)?qkQ(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};
var zfN=[10];g.c(tqN,Az);tqN.prototype.D=function(q){return Ya(q)?kDZ(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};g.c(ikt,L0);g.E=ikt.prototype;g.E.o3=function(q){var J=L0.prototype.o3.call(this,q);J.mainVideoEntity=new w10(q,this.lX,this.B);J.mainPlaylistEntity=new UuB(q,this.lX,this.B);J.mainDownloadsListEntity=new tqN(q,this.lX,this.B);return J};
g.E.refreshAllStaleEntities=function(q,J){var t=this,x,k,H,v,r,C,Y,N,b,m,O;return g.U(function(F){switch(F.D){case 1:x=[];if(!t.lX.G("web_player_offline_playlist_auto_refresh")){F.bX(2);break}return g.I(F,HkV(t,q,J),3);case 3:x=F.B;case 2:return g.I(F,TL.getInstance(),4);case 4:return k=F.B,g.I(F,(H=k)==null?void 0:H.get("sdois"),5);case 5:return v=F.B,g.I(F,(r=k)==null?void 0:r.get("lmqf"),6);case 6:C=F.B;if(!v){F.bX(7);break}N=x;b=N.concat;return g.I(F,v95(t,v,(Y=C)!=null?Y:"SD",q===0),8);case 8:x=
b.call(N,F.B);case 7:return m=x,O=m.concat,g.I(F,L0.prototype.refreshAllStaleEntities.call(t,q,J),9);case 9:return x=O.call(m,F.B),F.return(x)}})};
g.E.eb=function(q){var J,t,x,k,H,v,r,C;return g.U(function(Y){if(Y.D==1)return g.I(Y,at(),2);if(Y.D!=3)return(J=Y.B)?g.I(Y,zL(J,g.$6,"mainDownloadsListEntity"),3):Y.return(!1);t=Y.B;if((x=t)==null?0:(k=x.downloads)==null?0:k.length)for(H=g.u$(q,"mainVideoEntity"),v=g.M(t.downloads),r=v.next();!r.done;r=v.next())if(C=r.value,C.videoItem===H)return Y.return(!0);return Y.return(!1)})};
g.E.Xi=function(){var q=this,J,t,x,k,H,v,r,C;return g.U(function(Y){if(Y.D==1)return g.I(Y,at(),2);if(Y.D!=3)return(J=Y.B)?g.I(Y,GL(J,"downloadStatusEntity"),3):Y.return([]);t=Y.B;x=[];k=g.M(t);for(H=k.next();!H.done;H=k.next())v=H.value,v.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&v.key&&(r=g.l$(v.key).entityId,x.push(r));return x.length?(C={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Y.return(lg(q,x,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
C))):Y.return([])})};
g.E.MN=function(){var q;return g.U(function(J){return J.D==1?g.I(J,at(),2):(q=J.B)?g.I(J,wu(q,{mode:"readwrite",HK:!0},function(t){return du(t,"mainVideoEntity").then(function(x){var k=[];x=g.M(x);for(var H=x.next();!H.done;H=x.next()){H=H.value;var v=void 0;(v=H.userState)!=null&&v.playbackPosition||(v=g.l$(H.key).entityId,v={key:g.u$(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:"0"},k.push(eC(t,v,"videoPlaybackPositionEntity")),H.userState={playbackPosition:v.key},k.push(eC(t,
H,"mainVideoEntity")))}return g.y6.all(k)})}),0):J.return()})};
g.E.S0=function(){var q,J,t,x,k,H,v,r,C,Y,N,b,m,O,F,y,p,n,D,h,X,d,z,u,x4,iB,qP,rq,G,yn,nX,fX,SP,rQ,Qn,Di,ix,S;return g.U(function(RC){if(RC.D==1)return g.I(RC,at(),2);if(RC.D!=3){q=RC.B;if(!q)return RC.return();J=g.u$("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.I(RC,wu(q,{mode:"readonly",HK:!0},function(lx){return g.y6.all([Wp(lx,J,"mainDownloadsListEntity"),Wp(lx,g.$6,"mainDownloadsListEntity"),du(lx,"mainVideoEntity"),du(lx,"mainPlaylistEntity")])}),3)}t=RC.B;
x=g.M(t);k=x.next().value;H=x.next().value;v=x.next().value;r=x.next().value;C=k;Y=H;N=v;b=r;m=new Set;if((O=C)==null?0:(F=O.downloads)==null?0:F.length)for(y=g.M(C.downloads),p=y.next();!p.done;p=y.next())n=p.value,D=void 0,(h=(D=n.videoItem)!=null?D:n.playlistItem)&&m.add(h);if((X=Y)==null?0:(d=X.downloads)==null?0:d.length)for(z=g.M(Y.downloads),u=z.next();!u.done;u=z.next())x4=u.value,x4.videoItem&&m.add(x4.videoItem);iB=new Set;qP=[];rq=g.M(b);for(G=rq.next();!G.done;G=rq.next()){yn=G.value;
if(yn.videos)for(nX=g.M(yn.videos),fX=nX.next();!fX.done;fX=nX.next())SP=fX.value,(rQ=JSON.parse(g.l$(SP).entityId).videoId)&&iB.add(rQ);yn.key&&!m.has(yn.key)&&qP.push(yn.key)}Qn=g.M(N);for(Di=Qn.next();!Di.done;Di=Qn.next())ix=Di.value,ix.key&&!m.has(ix.key)&&(S=g.l$(ix.key).entityId,iB.has(S)||qP.push(ix.key));return qP.length?g.I(RC,W3t(q,qP),0):RC.bX(0)})};g.c(Rvt,Az);Rvt.prototype.D=function(q){return C0(q)?C_u(this,q):Ya(q)?Yk0(this,q):Nt(q)?NoV(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};
var V3=[10];g.c(m_N,Az);m_N.prototype.D=function(q){return C0(q)?Fxu(this,q):Ya(q)?E9Q(this,q):Nt(q)?cIa(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};
var zU=[10];g.c(g9N,Az);g9N.prototype.D=function(q){return C0(q)?SkN(this,q):Ya(q)?D_o(this,q):Nt(q)?n9o(this,q):Promise.reject(Error("Unsupported action type: "+q.actionType))};
var smx=[10];g.c(GU,L0);GU.prototype.o3=function(q){var J=L0.prototype.o3.call(this,q);J.musicTrack=new g9N(q,this.B);J.musicPlaylist=new m_N(q,this.B);J.musicAlbumRelease=new Rvt(q,this.B);return J};
GU.prototype.refreshAllStaleEntities=function(q,J){var t=this,x,k,H;return g.U(function(v){if(v.D==1)return g.I(v,QmD(t,q,J),2);if(v.D!=3)return k=x=v.B,H=k.concat,g.I(v,L0.prototype.refreshAllStaleEntities.call(t,q,J),3);x=H.call(k,v.B);return v.return(x)})};g.c(BoN,g.bw);g.E=BoN.prototype;g.E.create=function(){var q=this;g.W(this,this.events);if(g.ww(this.lX))this.B=new ikt(this.lX,this.player);else if(g.X2(this.lX)||g.a1(this.lX)==="WEB_MUSIC_INTEGRATIONS")this.B=new GU(this.lX,this.player);this.events.S(this.player,"onPlaybackStartExternal",function(){q.Lp()});
this.events.S(this.player,"videodatachange",function(){q.Lp()});
this.lX.G("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.Zk)};
g.E.m0=function(){return!1};
g.E.hV=function(q,J,t,x){var k=this;return g.U(function(H){return k.B?H.return(lg(k.B,q,J,t,x)):H.return(Promise.reject())})};
g.E.deleteAll=function(){return this.B.deleteAll()};
g.E.Eu=function(q){return this.B.Eu(q)};
g.E.refreshAllStaleEntities=function(q){return this.B.refreshAllStaleEntities(q)};
g.E.setUpPositionSyncInterval=function(q){this.B.setUpPositionSyncInterval(q)};
g.E.Ml=function(q){this.B.Ml(q)};
g.E.k9=function(q){return this.B.k9(q)};
g.E.Lp=function(){var q=this,J;return g.U(function(t){J=q.player.getVideoData();return g.Lh(J)?AID(J)&&q.D!==J.clientPlaybackNonce?g.I(t,$_D(q,J),0):t.bX(0):t.return()})};
g.E.Zk=function(q){var J=this,t,x,k,H,v,r,C;return g.U(function(Y){if(Y.D==1)return t=J.player.getVideoData(),x=t.mN,g.by(q,2)||g.by(q,512)?g.I(Y,at(),2):Y.return();if(Y.D!=3){k=Y.B;if(!k)return xa("PES is undefined"),Y.return();H=t.videoId;return g.I(Y,zL(k,g.u$(H,"mainVideoEntity"),"mainVideoEntity"),3)}v=Y.B;if(!v)return Y.return();r=Math.floor(x).toString();C={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:r}};return g.I(Y,J.hV([H],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
C),0)})};
g.E.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.E.updateDownloadState=function(q,J){var t,x,k,H;return g.U(function(v){if(v.D==1)return g.I(v,at(),2);t=v.B;if(!t)return xa("PES is undefined"),v.return();x=g.l$(q);k=x.entityType;H=x.entityId;return g.I(v,bg(H,k,t,J,!0),0)})};g.Nm("offline",BoN);})(_yt_player);
